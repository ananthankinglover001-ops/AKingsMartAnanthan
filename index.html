<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kings Mart Professional - Advanced Analytics & Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --accent: #f97316;
            --accent-dark: #ea580c;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #06b6d4;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --radius: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.25rem;
            --radius-2xl: 1.5rem;
            --radius-3xl: 2rem;
            --radius-full: 9999px;
            --spacing: 1rem;
            --spacing-xs: 0.5rem;
            --spacing-sm: 0.75rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 2.5rem;
            --spacing-3xl: 3rem;
            --spacing-4xl: 4rem;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--accent));
            --gradient-success: linear-gradient(135deg, var(--success), #059669);
            --gradient-warning: linear-gradient(135deg, var(--warning), #d97706);
            --gradient-error: linear-gradient(135deg, var(--error), #dc2626);
        }

        [data-theme="dark"] {
            --gray-50: #111827;
            --gray-100: #1f2937;
            --gray-200: #374151;
            --gray-300: #4b5563;
            --gray-400: #6b7280;
            --gray-500: #9ca3af;
            --gray-600: #d1d5db;
            --gray-700: #e5e7eb;
            --gray-800: #f3f4f6;
            --gray-900: #f9fafb;
            --white: #1f2937;
        }

        *, *::before, *::after { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        html { 
            font-size: 16px; 
            scroll-behavior: smooth; 
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: var(--transition);
            overflow-x: hidden;
            position: relative;
        }

        /* Enhanced Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { 
            background: var(--gray-100); 
            border-radius: var(--radius); 
        }
        ::-webkit-scrollbar-thumb { 
            background: var(--gradient-primary);
            border-radius: var(--radius); 
            border: 1px solid var(--gray-100);
        }
        ::-webkit-scrollbar-thumb:hover { 
            background: var(--gradient-success); 
        }

        /* Particle Background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: -1;
            opacity: 0.6;
        }

        /* Enhanced Animations */
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }
        
        @keyframes fadeInUp { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(30px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        @keyframes scaleIn { 
            from { opacity: 0; transform: scale(0.95); } 
            to { opacity: 1; transform: scale(1); } 
        }
        
        @keyframes pulse { 
            0%, 100% { transform: scale(1); } 
            50% { transform: scale(1.05); } 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        
        @keyframes float { 
            0%, 100% { transform: translateY(0px); } 
            50% { transform: translateY(-10px); }
        }
        
        @keyframes gradientShift { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Animation Classes */
        .animate-fadeIn { animation: fadeIn 0.6s ease-out; }
        .animate-fadeInUp { animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-slideUp { animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-scaleIn { animation: scaleIn 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-bounceIn { animation: bounceIn 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-pulse { animation: pulse 2s ease-in-out infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }

        /* Enhanced Hover Effects */
        .hover-lift { 
            transition: var(--transition); 
            cursor: pointer;
        }

        .hover-lift:hover { 
            transform: translateY(-4px); 
            box-shadow: var(--shadow-xl); 
        }

        .hover-glow {
            transition: var(--transition);
        }

        .hover-glow:hover {
            box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
            transform: translateY(-2px);
        }

        /* Enhanced Loading Screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--gradient-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .loading-screen.hidden { 
            opacity: 0; 
            visibility: hidden; 
            transform: scale(0.9); 
        }

        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: var(--spacing-xl);
            border-radius: var(--radius-2xl);
            animation: float 2s ease-in-out infinite;
            box-shadow: var(--shadow-xl);
        }

        .loading-text {
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing);
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .loading-progress {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-top: var(--spacing-xl);
        }

        .loading-progress-bar {
            height: 100%;
            background: var(--gradient-success);
            border-radius: var(--radius-full);
            width: 0%;
            transition: width 0.3s ease-out;
        }

        /* Enhanced Login Container */
        .login-container {
            min-height: 100vh;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xl);
            position: relative;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-3xl);
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-2xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: bounceIn 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-lg);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        .login-title {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: var(--spacing-sm);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }

        .login-subtitle {
            font-size: 1rem;
            color: var(--gray-600);
            text-align: center;
            margin-bottom: var(--spacing-2xl);
            font-weight: 500;
            line-height: 1.5;
        }

        .login-footer {
            margin-top: var(--spacing-xl);
            text-align: center;
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Enhanced Form Elements */
        .form-group {
            margin-bottom: var(--spacing-lg);
            position: relative;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .form-input, .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 500;
            background: var(--white);
            transition: var(--transition);
            min-height: 44px;
        }

        .form-input.login-input {
            padding-left: 3.5rem;
        }

        .form-input:focus, .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background: var(--white);
        }

        .form-icon {
            position: absolute;
            left: 1rem;
            top: 2.25rem;
            color: var(--gray-400);
            font-size: 1.125rem;
        }

        .form-error {
            font-size: 0.75rem;
            color: var(--error);
            margin-top: var(--spacing-xs);
        }

        .form-help {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: var(--spacing-xs);
        }

        /* Enhanced Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        /* Enhanced Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
            gap: var(--spacing-sm);
            position: relative;
            white-space: nowrap;
            user-select: none;
            min-height: 44px;
        }

        .btn:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
        }

        .btn-sm {
            padding: 0.625rem 1.25rem;
            font-size: 0.8125rem;
            min-height: 36px;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
            min-height: 48px;
        }

        .btn-xl {
            padding: 1.25rem 2.5rem;
            font-size: 1.125rem;
            min-height: 52px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-200);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-200);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--gradient-success);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-danger {
            background: var(--gradient-error);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-warning:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #0891b2);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-info:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        /* Enhanced Dashboard Layout */
        .dashboard {
            display: flex;
            min-height: 100vh;
            background: var(--gray-50);
            position: relative;
        }

        .sidebar {
            width: 280px;
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }

        .sidebar.collapsed { 
            width: 80px; 
        }

        .sidebar-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--gray-200);
            position: relative;
            background: linear-gradient(135deg, var(--gray-50), rgba(37, 99, 235, 0.03));
        }

        .sidebar-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray-600);
        }

        .sidebar-toggle:hover {
            background: var(--primary);
            color: var(--white);
            transform: scale(1.1);
        }

        .sidebar-logo {
            width: 3rem;
            height: 3rem;
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-sm);
            animation: float 4s ease-in-out infinite;
            box-shadow: var(--shadow-md);
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--gray-900);
            letter-spacing: -0.025em;
            transition: var(--transition);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-subtitle {
            font-size: 0.75rem;
            color: var(--gray-500);
            font-weight: 600;
            margin-top: 0.25rem;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sidebar.collapsed .sidebar-title,
        .sidebar.collapsed .sidebar-subtitle {
            opacity: 0;
        }

        /* Enhanced Navigation */
        .sidebar-nav {
            flex: 1;
            padding: var(--spacing-lg) 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: var(--spacing-xl);
        }
        
        .nav-section-title {
            font-size: 0.6875rem;
            font-weight: 700;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0 var(--spacing-lg);
            margin-bottom: var(--spacing);
            transition: var(--transition);
        }

        .sidebar.collapsed .nav-section-title {
            opacity: 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: var(--spacing) var(--spacing-lg);
            color: var(--gray-700);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            border-radius: var(--radius);
            margin: 0.25rem var(--spacing-sm);
            gap: var(--spacing);
            position: relative;
        }

        .nav-item:hover,
        .nav-item.active {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(249, 115, 22, 0.05));
            color: var(--primary);
            transform: translateX(4px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.12), rgba(249, 115, 22, 0.08));
            font-weight: 600;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: calc(-1 * var(--spacing-sm));
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--gradient-primary);
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .nav-icon {
            width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.125rem;
        }

        .nav-text {
            flex: 1;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 0.875rem;
        }

        .nav-badge {
            background: var(--gradient-error);
            color: var(--white);
            font-size: 0.6875rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-full);
            min-width: 1.25rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .nav-badge {
            opacity: 0;
        }

        .sidebar-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--gray-200);
            text-align: center;
            font-size: 0.6875rem;
            color: var(--gray-400);
            font-weight: 600;
        }

        /* Enhanced Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--gray-200);
            padding: var(--spacing-lg) var(--spacing-xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 50;
            min-height: 80px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--gray-600);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius);
        }

        .page-info {
            display: flex;
            flex-direction: column;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 800;
            color: var(--gray-900);
            margin: 0;
            letter-spacing: -0.025em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .breadcrumb {
            font-size: 0.8125rem;
            color: var(--gray-500);
            font-weight: 500;
            margin-top: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: var(--spacing);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .header-btn {
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray-600);
            position: relative;
        }

        .header-btn:hover {
            background: var(--primary);
            color: var(--white);
            transform: scale(1.05);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--error);
            color: var(--white);
            font-size: 0.625rem;
            font-weight: 700;
            padding: 0.125rem 0.375rem;
            border-radius: var(--radius-full);
            min-width: 1rem;
            text-align: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
        }

        .user-menu:hover {
            background: var(--gray-100);
            transform: translateY(-1px);
        }

        .user-avatar {
            width: 2rem;
            height: 2rem;
            background: var(--gradient-primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-900);
            line-height: 1.2;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--gray-500);
            line-height: 1.2;
        }

        .dropdown {
            position: relative;
        }

        .dropdown-content {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 100;
            margin-top: var(--spacing-xs);
        }

        .dropdown.show .dropdown-content {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing);
            color: var(--gray-700);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .dropdown-item:hover {
            background: var(--gray-50);
            color: var(--primary);
        }

        .dropdown-item:first-child {
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        /* Enhanced Content Area */
        .content {
            flex: 1;
            padding: var(--spacing-xl);
            background: var(--gray-50);
            overflow-y: auto;
            position: relative;
        }

        .page-content {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 100%;
            position: relative;
        }

        /* Enhanced Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-3xl);
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            position: relative;
            transition: var(--transition);
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
        }

        .stat-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-icon {
            width: 3rem;
            height: 3rem;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-sm);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: var(--spacing-sm);
            line-height: 1;
            letter-spacing: -0.025em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--gray-500);
        }

        /* Enhanced Cards */
        .card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            overflow: hidden;
            transition: var(--transition);
            position: relative;
            margin-bottom: var(--spacing-xl);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--gray-50), rgba(37, 99, 235, 0.02));
            flex-wrap: wrap;
            gap: var(--spacing);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
            letter-spacing: -0.025em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-subtitle {
            font-size: 0.8125rem;
            color: var(--gray-500);
            margin: 0.5rem 0 0 0;
            font-weight: 500;
            line-height: 1.4;
        }

        .card-content {
            padding: var(--spacing-xl);
        }

        /* Enhanced Quick Actions */
        .quick-action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-3xl);
        }

        .quick-action {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(249, 115, 22, 0.05));
            border: 1px solid rgba(37, 99, 235, 0.1);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            color: var(--gray-700);
            position: relative;
        }

        .quick-action:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(249, 115, 22, 0.08));
            border-color: rgba(37, 99, 235, 0.2);
        }

        .quick-action-icon {
            font-size: 2.5rem;
            margin-bottom: var(--spacing);
            color: var(--primary);
            transition: var(--transition);
        }

        .quick-action:hover .quick-action-icon {
            transform: scale(1.1);
            color: var(--accent);
        }

        .quick-action-title {
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            font-size: 1.125rem;
            color: var(--gray-900);
        }

        .quick-action-description {
            font-size: 0.8125rem;
            color: var(--gray-500);
            line-height: 1.5;
            font-weight: 500;
        }

        /* Customer Management Styles */
        .customer-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            transition: var(--transition);
        }

        .customer-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .customer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
            margin-right: var(--spacing);
        }

        .customer-info {
            flex: 1;
        }

        .customer-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .customer-details {
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.4;
        }

        .complaint-card {
            background: linear-gradient(135deg, var(--white), var(--gray-50));
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border-left: 4px solid var(--warning);
            margin-bottom: var(--spacing);
            transition: var(--transition);
        }

        .complaint-card.resolved {
            border-left-color: var(--success);
        }

        .complaint-card.urgent {
            border-left-color: var(--error);
        }

        .complaint-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-sm);
        }

        .complaint-id {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary);
            background: rgba(37, 99, 235, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
        }

        .complaint-status {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            text-transform: uppercase;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-resolved {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-urgent {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .delivery-timeline {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm) 0;
            position: relative;
        }

        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 10px;
            top: 32px;
            width: 2px;
            height: 24px;
            background: var(--gray-300);
        }

        .timeline-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gray-300);
            margin-right: var(--spacing);
            flex-shrink: 0;
        }

        .timeline-dot.active {
            background: var(--primary);
        }

        .timeline-dot.completed {
            background: var(--success);
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.875rem;
        }

        .timeline-date {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .order-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--gray-200);
            margin-bottom: var(--spacing);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing);
            padding-bottom: var(--spacing);
            border-bottom: 1px solid var(--gray-200);
        }

        .order-id {
            font-weight: 700;
            color: var(--primary);
        }

        .order-status {
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .customer-search {
            position: relative;
            margin-bottom: var(--spacing-xl);
        }

        .customer-filters {
            display: flex;
            gap: var(--spacing);
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            border: 1px solid var(--gray-300);
            background: var(--white);
            color: var(--gray-700);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .filter-chip:hover,
        .filter-chip.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        /* Analytics Dashboard Styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-3xl);
        }

        .chart-container {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            position: relative;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .chart-title i {
            color: var(--primary);
            font-size: 1.25rem;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing);
        }

        .kpi-card {
            background: linear-gradient(135deg, var(--white), var(--gray-50));
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--gray-200);
            transition: var(--transition);
            position: relative;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .kpi-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }

        .kpi-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .kpi-icon {
            width: 2rem;
            height: 2rem;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .kpi-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--spacing-xs);
            line-height: 1.2;
        }

        .kpi-change {
            font-size: 0.6875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .kpi-change.positive { color: var(--success); }
        .kpi-change.negative { color: var(--error); }
        .kpi-change.neutral { color: var(--gray-500); }

        /* Enhanced Tables */
        .table-container {
            background: var(--white);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8125rem;
        }

        .table th,
        .table td {
            padding: var(--spacing) var(--spacing-lg);
            text-align: left;
            border-bottom: 1px solid var(--gray-100);
            vertical-align: middle;
        }

        .table th {
            background: linear-gradient(135deg, var(--gray-50), rgba(37, 99, 235, 0.02));
            font-weight: 600;
            color: var(--gray-900);
            text-transform: uppercase;
            letter-spacing: 0.025em;
            font-size: 0.6875rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table tbody tr {
            transition: var(--transition);
        }

        .table tbody tr:hover {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.02), rgba(249, 115, 22, 0.01));
        }

        .table-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        /* Search and Filters */
        .search-filters {
            display: flex;
            gap: var(--spacing);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .search-input {
            position: relative;
            flex: 1;
            min-width: 250px;
        }

        .search-input input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 500;
            background: var(--white);
            transition: var(--transition);
        }

        .search-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .suggestions-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-xs);
            max-height: 350px;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            z-index: 50;
        }

        .suggestion-item {
            padding: var(--spacing);
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--radius);
            margin: 0.25rem;
        }

        .suggestion-item:hover {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(249, 115, 22, 0.02));
        }

        /* Enhanced Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--spacing);
            backdrop-filter: blur(8px);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-2xl);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95) translateY(20px);
            transition: var(--transition);
            border: 1px solid var(--gray-200);
        }

        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--gray-50), rgba(37, 99, 235, 0.02));
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--gray-400);
            padding: 0.5rem;
            transition: var(--transition);
            border-radius: var(--radius);
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .modal-body {
            padding: var(--spacing-xl);
        }

        .modal-footer {
            padding: var(--spacing-xl);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing);
            background: var(--gray-50);
        }

        /* Enhanced Toast Notifications */
        .toast-container {
            position: fixed;
            top: var(--spacing-xl);
            right: var(--spacing-xl);
            z-index: 1100;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            max-width: 400px;
        }

        .toast {
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-200);
            padding: var(--spacing);
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            transform: translateX(400px) scale(0.95);
            transition: var(--transition);
            position: relative;
        }

        .toast.show {
            transform: translateX(0) scale(1);
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 4px;
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
        }

        .toast.success::before { background: var(--gradient-success); }
        .toast.error::before { background: var(--gradient-error); }
        .toast.warning::before { background: var(--gradient-warning); }
        .toast.info::before { background: var(--gradient-primary); }

        .toast-content {
            flex: 1;
        }

        .toast-message {
            font-size: 0.8125rem;
            color: var(--gray-700);
            font-weight: 500;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray-400);
            padding: 0.25rem;
            transition: var(--transition);
            border-radius: var(--radius);
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-close:hover {
            color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Enhanced Empty States */
        .empty-state {
            text-align: center;
            padding: var(--spacing-3xl);
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-xl);
            opacity: 0.4;
            animation: float 3s ease-in-out infinite;
            color: var(--gray-300);
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-700);
            margin-bottom: var(--spacing-sm);
        }

        .empty-state-description {
            font-size: 1rem;
            margin-bottom: var(--spacing-2xl);
            line-height: 1.5;
            font-weight: 500;
        }

        /* Loading Spinners */
        .loading-spinner {
            width: 1.25rem;
            height: 1.25rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s linear infinite;
        }

        .spinner-lg {
            width: 2rem;
            height: 2rem;
            border-width: 4px;
        }

        /* Custom Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            font-size: 0.6875rem;
            font-weight: 600;
            border-radius: var(--radius-full);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-primary {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(37, 99, 235, 0.05));
            color: var(--primary);
            border: 1px solid rgba(37, 99, 235, 0.2);
        }

        .badge-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .badge-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .badge-danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            color: var(--error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .badge-secondary {
            background: linear-gradient(135deg, var(--gray-100), var(--gray-50));
            color: var(--gray-700);
            border: 1px solid var(--gray-200);
        }

        /* Progress Bars */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width 0.5s ease-out;
        }

        /* Invoice Styles */
        .invoice-preview {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            overflow: hidden;
            margin-top: var(--spacing-xl);
        }

        .invoice-header {
            background: linear-gradient(135deg, var(--gray-50), rgba(37, 99, 235, 0.02));
            padding: var(--spacing-2xl);
            border-bottom: 1px solid var(--gray-200);
            text-align: center;
        }

        .invoice-logo {
            width: 60px;
            height: 60px;
            margin: 0 auto var(--spacing);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .invoice-company-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: var(--spacing-sm);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .invoice-number,
        .invoice-date {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
            margin: 0.25rem 0;
        }

        .invoice-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
            padding: var(--spacing-2xl);
        }

        .invoice-section {
            background: var(--gray-50);
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
        }

        .invoice-section-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--gray-700);
            margin-bottom: var(--spacing);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .invoice-section-content {
            font-size: 0.8125rem;
            color: var(--gray-600);
            line-height: 1.5;
        }

        .invoice-totals {
            background: var(--gray-50);
            padding: var(--spacing-xl);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
        }

        .invoice-total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            font-size: 0.875rem;
            font-weight: 500;
            border-bottom: 1px solid var(--gray-200);
        }

        .invoice-total-row:last-child {
            border-bottom: none;
        }

        .invoice-total-row.final {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            border-top: 2px solid var(--gray-300);
            margin-top: var(--spacing-sm);
            padding-top: var(--spacing);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                gap: var(--spacing);
            }
            
            .quick-action-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .invoice-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                height: 100vh;
                z-index: 200;
                transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                width: 280px;
            }

            .sidebar.open {
                left: 0;
                box-shadow: var(--shadow-2xl);
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .header {
                padding: var(--spacing) var(--spacing-lg);
            }

            .header-left {
                gap: var(--spacing);
            }

            .page-title {
                font-size: 1.5rem;
            }

            .content {
                padding: var(--spacing);
            }

            .stats-grid,
            .quick-action-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing);
            }

            .stat-value {
                font-size: 2rem;
            }

            .toast-container {
                left: var(--spacing);
                right: var(--spacing);
                max-width: none;
            }

            .modal {
                margin: var(--spacing);
                max-width: none;
                width: calc(100% - 2rem);
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing);
            }

            .search-filters {
                flex-direction: column;
            }

            .search-input {
                min-width: auto;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 1.25rem;
            }

            .btn {
                padding: 0.75rem 1.25rem;
                font-size: 0.8125rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            .card-content,
            .modal-body,
            .modal-footer {
                padding: var(--spacing);
            }

            .quick-action {
                padding: var(--spacing-lg);
            }

            .quick-action-icon {
                font-size: 2rem;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .header,
            .header-actions,
            .quick-action-grid,
            .loading-screen,
            .toast-container,
            .modal-overlay,
            #particles-js {
                display: none !important;
            }

            .main-content {
                margin-left: 0;
            }

            .content {
                padding: 0;
            }

            body {
                background: var(--white);
                color: black;
            }

            .page-content {
                animation: none;
            }

            .card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Selection Styles */
        ::selection {
            background: var(--primary);
            color: var(--white);
        }

        /* Focus Styles */
        .focus-outline:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Hidden Class */
        .hidden { 
            display: none !important; 
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .p-0 { padding: 0; }
        .p-1 { padding: 0.25rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .rounded { border-radius: var(--radius); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-xl { border-radius: var(--radius-xl); }
        .shadow { box-shadow: var(--shadow); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    
    <!-- Enhanced Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <img src="images.jpg" alt="Kings Mart Professional logo with KM initials in white on a blue background, representing a modern business analytics and customer management system. The logo appears floating and welcoming, conveying a professional and innovative atmosphere." class="loading-logo">
        <div class="loading-text">Kings Mart Professional</div>
        <div class="loading-text" style="font-size: 1rem; font-weight: 500; margin-bottom: var(--spacing-2xl);">Advanced Analytics & Customer Management System</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgressBar"></div>
        </div>
    </div>

    <!-- Enhanced Login Page -->
    <div id="loginPage" class="login-container hidden">
        <div class="login-card">
            <img src="images.jpg" alt="Kings Mart Logo" class="login-logo">
            <h1 class="login-title">Kings Mart</h1>
            <p class="login-subtitle">Professional Analytics & Customer Management System<br>Complete Business Intelligence Solution</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername" class="form-label">Username</label>
                    <input 
                        type="text" 
                        class="form-input login-input" 
                        id="loginUsername" 
                        placeholder="Enter your username" 
                        required
                        value="admin"
                    >
                    <i class="fas fa-user form-icon"></i>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword" class="form-label">Password</label>
                    <input 
                        type="password" 
                        class="form-input login-input" 
                        id="loginPassword" 
                        placeholder="Enter your password" 
                        required
                        value="admin123"
                    >
                    <i class="fas fa-lock form-icon"></i>
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; margin-top: var(--spacing-lg);">
                    <span class="loading-spinner hidden" id="loginLoading"></span>
                    <span id="loginButtonText">Access Dashboard</span>
                    <i class="fas fa-rocket"></i>
                </button>
            </form>
            
            <div class="login-footer">
                 <strong>Demo Credentials:</strong> <strong style="color: var(--primary);">admin</strong> / <strong style="color: var(--accent);">admin123</strong>
                <br><small> 2025 Kings Mart Professional. All rights reserved.</small>
            </div>
        </div>
    </div>

    <!-- Enhanced Dashboard Page -->
    <div id="dashboardPage" class="dashboard hidden">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars" id="toggleIcon"></i>
                </button>
                <img src="images.jpg" alt="Kings Mart Logo" class="sidebar-logo">
                <div class="sidebar-title">Kings Mart</div>
                <div class="sidebar-subtitle">Professional</div>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Core System</div>
                    <a href="#" class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
                        <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                        <span class="nav-text">Analytics Dashboard</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Inventory</div>
                    <a href="#" class="nav-item" data-page="stock" onclick="showPage('stock')">
                        <span class="nav-icon"><i class="fas fa-boxes"></i></span>
                        <span class="nav-text">Stock Management</span>
                        <span class="nav-badge hidden" id="lowStockBadge">0</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Sales</div>
                    <a href="#" class="nav-item" data-page="cart" onclick="showPage('cart')">
                        <span class="nav-icon"><i class="fas fa-shopping-cart"></i></span>
                        <span class="nav-text">Smart Cart</span>
                        <span class="nav-badge hidden" id="cartBadge">0</span>
                    </a>
                    <a href="#" class="nav-item" data-page="invoice" onclick="showPage('invoice')">
                        <span class="nav-icon"><i class="fas fa-file-invoice"></i></span>
                        <span class="nav-text">Invoice Generator</span>
                    </a>
                    <a href="#" class="nav-item" data-page="invoices" onclick="showPage('invoices')">
                        <span class="nav-icon"><i class="fas fa-history"></i></span>
                        <span class="nav-text">Invoice History</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Customer Management</div>
                    <a href="#" class="nav-item" data-page="customers" onclick="showPage('customers')">
                        <span class="nav-icon"><i class="fas fa-users"></i></span>
                        <span class="nav-text">Customer Hub</span>
                    </a>
                    <a href="#" class="nav-item" data-page="complaints" onclick="showPage('complaints')">
                        <span class="nav-icon"><i class="fas fa-exclamation-circle"></i></span>
                        <span class="nav-text">Complaints</span>
                        <span class="nav-badge hidden" id="complaintsCount">0</span>
                    </a>
                    <a href="#" class="nav-item" data-page="orders" onclick="showPage('orders')">
                        <span class="nav-icon"><i class="fas fa-truck"></i></span>
                        <span class="nav-text">Order Tracking</span>
                        <span class="nav-badge hidden" id="pendingOrdersCount">0</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Business Intelligence</div>
                    <a href="#" class="nav-item" data-page="analytics" onclick="showPage('analytics')">
                        <span class="nav-icon"><i class="fas fa-chart-pie"></i></span>
                        <span class="nav-text">Business Analytics</span>
                    </a>
                    <a href="#" class="nav-item" data-page="reports" onclick="showPage('reports')">
                        <span class="nav-icon"><i class="fas fa-file-chart-line"></i></span>
                        <span class="nav-text">Reports</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <a href="#" class="nav-item" data-page="settings" onclick="showPage('settings')">
                        <span class="nav-icon"><i class="fas fa-cogs"></i></span>
                        <span class="nav-text">Settings</span>
                    </a>
                </div>
            </div>
            
            <div class="sidebar-footer">
                 2025 Kings Mart Professional v2.1
            </div>
        </nav>

        <div class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" onclick="toggleMobileSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-info">
                        <h1 class="page-title" id="pageTitle">Analytics Dashboard</h1>
                        <nav class="breadcrumb" id="breadcrumb">
                            <a href="#" onclick="showPage('dashboard')"> Home</a> / Analytics Dashboard
                        </nav>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="header-actions">
                        <button class="header-btn hover-glow" onclick="showNotifications()" title="Notifications">
                            <i class="fas fa-bell"></i>
                            <div class="notification-badge hidden" id="notificationCount">0</div>
                        </button>
                        <button class="header-btn hover-glow" onclick="showGlobalSearch()" title="Search">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="header-btn hover-glow" onclick="toggleTheme()" id="themeToggle" title="Toggle Theme">
                            <i class="fas fa-moon" id="themeIcon"></i>
                        </button>
                        <button class="header-btn hover-glow" onclick="showHelp()" title="Help">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                    
                    <div class="dropdown">
                        <div class="user-menu hover-glow" onclick="toggleUserMenu()">
                            <div class="user-avatar" id="userAvatar">A</div>
                            <div class="user-info">
                                <div class="user-name" id="userName">Admin</div>
                                <div class="user-role">Business Intelligence</div>
                            </div>
                            <i class="fas fa-chevron-down" style="margin-left: var(--spacing-xs); font-size: 0.75rem; color: var(--gray-400);"></i>
                        </div>
                        <div class="dropdown-content" id="userDropdown">
                            <div class="dropdown-item" onclick="showProfile()">
                                <i class="fas fa-user-circle"></i> Profile
                            </div>
                            <div class="dropdown-item" onclick="showPage('settings')">
                                <i class="fas fa-cogs"></i> Settings
                            </div>
                            <div class="dropdown-item" onclick="showKeyboardShortcuts()">
                                <i class="fas fa-keyboard"></i> Shortcuts
                            </div>
                            <div class="dropdown-item" onclick="logout()" style="color: var(--error); border-top: 1px solid var(--gray-100); margin-top: 0.5rem; padding-top: 1rem;">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <main class="content">
                <!-- Enhanced Analytics Dashboard -->
                <div id="dashboardContent" class="page-content">
                    <!-- Quick Actions with Clean Layout -->
                    <div class="quick-action-grid">
                        <div class="quick-action hover-lift" onclick="showPage('stock')">
                            <div class="quick-action-icon animate-float"><i class="fas fa-plus-circle"></i></div>
                            <div class="quick-action-title">Add Product</div>
                            <div class="quick-action-description">Advanced inventory management with real-time tracking</div>
                        </div>
                        <div class="quick-action hover-lift" onclick="showPage('cart')">
                            <div class="quick-action-icon animate-float" style="animation-delay: 0.5s;"><i class="fas fa-shopping-cart"></i></div>
                            <div class="quick-action-title">Smart Cart</div>
                            <div class="quick-action-description">AI-powered cart with intelligent recommendations</div>
                        </div>
                        <div class="quick-action hover-lift" onclick="showPage('customers')">
                            <div class="quick-action-icon animate-float" style="animation-delay: 1s;"><i class="fas fa-users"></i></div>
                            <div class="quick-action-title">Customer Hub</div>
                            <div class="quick-action-description">Comprehensive customer management and CRM system</div>
                        </div>
                        <div class="quick-action hover-lift" onclick="exportAllData()">
                            <div class="quick-action-icon animate-float" style="animation-delay: 1.5s;"><i class="fas fa-cloud-download-alt"></i></div>
                            <div class="quick-action-title">Export Data</div>
                            <div class="quick-action-description">Comprehensive business intelligence reports</div>
                        </div>
                    </div>

                    <!-- Enhanced Stats Grid with Clean Animations -->
                    <div class="stats-grid">
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.1s;">
                            <div class="stat-header">
                                <div class="stat-title">Total Products</div>
                                <div class="stat-icon" style="background: rgba(37, 99, 235, 0.1); color: var(--primary);">
                                    <i class="fas fa-boxes animate-float"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalProducts">0</div>
                            <div class="stat-change">
                                <i class="fas fa-cube"></i>
                                <span>Items in inventory</span>
                            </div>
                        </div>
                        
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.2s;">
                            <div class="stat-header">
                                <div class="stat-title">Active Cart</div>
                                <div class="stat-icon" style="background: rgba(249, 115, 22, 0.1); color: var(--accent);">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="cartItems">0</div>
                            <div class="stat-change">
                                <i class="fas fa-shopping-bag"></i>
                                <span>Items in cart</span>
                            </div>
                        </div>
                        
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.3s;">
                            <div class="stat-header">
                                <div class="stat-title">Total Customers</div>
                                <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
                                    <i class="fas fa-users animate-pulse"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalCustomersDash">0</div>
                            <div class="stat-change">
                                <i class="fas fa-user-plus"></i>
                                <span>Registered customers</span>
                            </div>
                        </div>
                        
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.4s;">
                            <div class="stat-header">
                                <div class="stat-title">Stock Alerts</div>
                                <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--error);">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="lowStockItems">0</div>
                            <div class="stat-change">
                                <i class="fas fa-bell"></i>
                                <span>Low stock items</span>
                            </div>
                        </div>
                    </div>

                    <!-- PowerBI-Style Analytics Section with Clean Layout -->
                    <div class="analytics-grid">
                        <div class="chart-container hover-lift animate-fadeInUp" style="animation-delay: 0.5s;">
                            <div class="chart-title">
                                <i class="fas fa-chart-line animate-pulse"></i>
                                Sales & Revenue Analytics
                            </div>
                            <canvas id="salesChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="kpi-grid">
                            <div class="kpi-card hover-lift" style="animation-delay: 0.6s;">
                                <div class="kpi-header">
                                    <div class="kpi-title">Today's Sales</div>
                                    <div class="kpi-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                </div>
                                <div class="kpi-value" id="todaySales">0</div>
                                <div class="kpi-change positive" id="todaySalesChange">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+12% from yesterday</span>
                                </div>
                            </div>
                            
                            <div class="kpi-card hover-lift" style="animation-delay: 0.7s;">
                                <div class="kpi-header">
                                    <div class="kpi-title">Monthly Revenue</div>
                                    <div class="kpi-icon" style="background: rgba(37, 99, 235, 0.1); color: var(--primary);">
                                        <i class="fas fa-rupee-sign"></i>
                                    </div>
                                </div>
                                <div class="kpi-value" id="monthlyRevenue">0</div>
                                <div class="kpi-change positive" id="monthlyRevenueChange">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+24% from last month</span>
                                </div>
                            </div>
                            
                            <div class="kpi-card hover-lift" style="animation-delay: 0.8s;">
                                <div class="kpi-header">
                                    <div class="kpi-title">Avg Order Value</div>
                                    <div class="kpi-icon" style="background: rgba(249, 115, 22, 0.1); color: var(--accent);">
                                        <i class="fas fa-receipt"></i>
                                    </div>
                                </div>
                                <div class="kpi-value" id="avgOrderValue">0</div>
                                <div class="kpi-change neutral" id="avgOrderChange">
                                    <i class="fas fa-minus"></i>
                                    <span>No change</span>
                                </div>
                            </div>
                            
                            <div class="kpi-card hover-lift" style="animation-delay: 0.9s;">
                                <div class="kpi-header">
                                    <div class="kpi-title">Top Categories</div>
                                    <div class="kpi-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
                                        <i class="fas fa-tags"></i>
                                    </div>
                                </div>
                                <div class="kpi-value" id="topCategory">Electronics</div>
                                <div class="kpi-change positive" id="topCategoryChange">
                                    <i class="fas fa-fire"></i>
                                    <span>Best seller</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Charts Row with Clean Spacing -->
                    <div class="analytics-grid">
                        <div class="chart-container hover-lift animate-fadeInUp" style="animation-delay: 1s;">
                            <div class="chart-title">
                                <i class="fas fa-chart-pie animate-spin" style="animation-duration: 4s;"></i>
                                Category Distribution
                            </div>
                            <canvas id="categoryChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="chart-container hover-lift animate-fadeInUp" style="animation-delay: 1.1s;">
                            <div class="chart-title">
                                <i class="fas fa-chart-bar animate-pulse"></i>
                                Inventory Levels
                            </div>
                            <canvas id="inventoryChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <!-- Welcome Section with Enhanced Clean Layout -->
                    <div class="card hover-lift animate-fadeIn" style="animation-delay: 1.2s;">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Welcome to Kings Mart Professional Analytics</h3>
                                <p class="card-subtitle">Advanced business intelligence with PowerBI-style analytics, customer management, and insights</p>
                            </div>
                        </div>
                        <div class="card-content">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: var(--spacing-2xl);">
                                <div>
                                    <h4 class="font-bold mb-3" style="color: var(--gray-900); display: flex; align-items: center; gap: var(--spacing-sm);">
                                        <i class="fas fa-rocket animate-float" style="color: var(--primary);"></i>
                                        Business Intelligence Features
                                    </h4>
                                    <div style="display: flex; flex-direction: column; gap: var(--spacing);">
                                        <div style="display: flex; align-items: center; gap: var(--spacing); padding: var(--spacing); border-radius: var(--radius-lg); background: rgba(16, 185, 129, 0.05); cursor: pointer; border: 1px solid rgba(16, 185, 129, 0.1);" class="hover-lift" onclick="showPage('analytics')">
                                            <div style="width: 2rem; height: 2rem; background: var(--success); color: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem;"></div>
                                            <span style="font-weight: 600; font-size: 0.875rem;">Real-time Analytics Dashboard</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: var(--spacing); padding: var(--spacing); border-radius: var(--radius-lg); background: rgba(37, 99, 235, 0.05); cursor: pointer; border: 1px solid rgba(37, 99, 235, 0.1);" class="hover-lift" onclick="showPage('customers')">
                                            <div style="width: 2rem; height: 2rem; background: var(--primary); color: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem;"></div>
                                            <span style="font-weight: 600; font-size: 0.875rem;">Customer Management Hub</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: var(--spacing); padding: var(--spacing); border-radius: var(--radius-lg); background: rgba(249, 115, 22, 0.05); cursor: pointer; border: 1px solid rgba(249, 115, 22, 0.1);" class="hover-lift" onclick="exportAllData()">
                                            <div style="width: 2rem; height: 2rem; background: var(--accent); color: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem;"></div>
                                            <span style="font-weight: 600; font-size: 0.875rem;">Data Export & Backup</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-bold mb-3" style="color: var(--gray-900); display: flex; align-items: center; gap: var(--spacing-sm);">
                                        <i class="fas fa-crown" style="color: var(--warning);"></i>
                                        Premium Features
                                    </h4>
                                    <div style="display: flex; flex-direction: column; gap: var(--spacing);">
                                        <div style="display: flex; align-items: center; gap: var(--spacing); padding: var(--spacing); border-radius: var(--radius-lg); background: var(--gray-50); border: 1px solid var(--gray-200);" class="hover-lift">
                                            <i class="fas fa-chart-line" style="color: var(--success);"></i>
                                            <span style="font-weight: 600; font-size: 0.875rem;">PowerBI-style Visualizations</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: var(--spacing); padding: var(--spacing); border-radius: var(--radius-lg); background: var(--gray-50); border: 1px solid var(--gray-200);" class="hover-lift">
                                            <i class="fas fa-brain animate-float" style="color: var(--primary);"></i>
                                            <span style="font-weight: 600; font-size: 0.875rem;">AI-powered Insights</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: var(--spacing); padding: var(--spacing); border-radius: var(--radius-lg); background: var(--gray-50); border: 1px solid var(--gray-200);" class="hover-lift">
                                            <i class="fas fa-mobile-alt" style="color: var(--accent);"></i>
                                            <span style="font-weight: 600; font-size: 0.875rem;">Mobile-responsive Interface</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Enhanced Keyboard Shortcuts Section -->
                            <div style="margin-top: var(--spacing-2xl); padding: var(--spacing-xl); background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(249, 115, 22, 0.05)); border-radius: var(--radius-lg); border: 1px solid rgba(37, 99, 235, 0.1);">
                                <h4 class="font-bold mb-3" style="color: var(--gray-900); display: flex; align-items: center; gap: var(--spacing-sm);">
                                    <i class="fas fa-keyboard" style="color: var(--info);"></i>
                                    Keyboard Shortcuts & Navigation
                                </h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: var(--spacing);">
                                    <div class="hover-lift" style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.8125rem;"><kbd style="background: var(--primary); color: var(--white); padding: 0.375rem 0.5rem; border-radius: var(--radius); font-weight: 600; font-size: 0.75rem;">Alt + 1</kbd> Analytics Dashboard</div>
                                    <div class="hover-lift" style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.8125rem;"><kbd style="background: var(--success); color: var(--white); padding: 0.375rem 0.5rem; border-radius: var(--radius); font-weight: 600; font-size: 0.75rem;">Alt + 2</kbd> Stock Management</div>
                                    <div class="hover-lift" style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.8125rem;"><kbd style="background: var(--accent); color: var(--white); padding: 0.375rem 0.5rem; border-radius: var(--radius); font-weight: 600; font-size: 0.75rem;">Alt + 3</kbd> Smart Cart</div>
                                    <div class="hover-lift" style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.8125rem;"><kbd style="background: var(--warning); color: var(--white); padding: 0.375rem 0.5rem; border-radius: var(--radius); font-weight: 600; font-size: 0.75rem;">Alt + 9</kbd> Customer Hub</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Hub Page -->
                <div id="customersContent" class="page-content hidden">
                    <!-- Customer Management Header -->
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Customer Hub</h3>
                                <p class="card-subtitle">Comprehensive customer management with advanced analytics and CRM features</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="showAddCustomerModal()">
                                    <i class="fas fa-user-plus"></i> Add Customer
                                </button>
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="exportCustomers()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                                <button class="btn btn-sm btn-info hover-glow" onclick="importCustomers()">
                                    <i class="fas fa-upload"></i> Import
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <!-- Customer Search and Filters -->
                            <div class="customer-search">
                                <input 
                                    type="text" 
                                    id="customerSearch" 
                                    placeholder=" Search customers by name, email, or phone..."
                                    oninput="searchCustomers()"
                                    class="form-control"
                                >
                            </div>
                            
                            <div class="customer-filters">
                                <div class="filter-chip active" onclick="filterCustomers('all')">All Customers</div>
                                <div class="filter-chip" onclick="filterCustomers('active')">Active</div>
                                <div class="filter-chip" onclick="filterCustomers('vip')">VIP</div>
                                <div class="filter-chip" onclick="filterCustomers('pending')">Pending Orders</div>
                                <div class="filter-chip" onclick="filterCustomers('complaints')">With Complaints</div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Statistics -->
                    <div class="stats-grid">
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.1s;">
                            <div class="stat-header">
                                <div class="stat-title">Total Customers</div>
                                <div class="stat-icon" style="background: rgba(37, 99, 235, 0.1); color: var(--primary);">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalCustomers">0</div>
                            <div class="stat-change">
                                <i class="fas fa-user-plus"></i>
                                <span>Registered customers</span>
                            </div>
                        </div>
                        
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.2s;">
                            <div class="stat-header">
                                <div class="stat-title">Active Orders</div>
                                <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
                                    <i class="fas fa-truck"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="activeOrders">0</div>
                            <div class="stat-change">
                                <i class="fas fa-shipping-fast"></i>
                                <span>In progress</span>
                            </div>
                        </div>
                        
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.3s;">
                            <div class="stat-header">
                                <div class="stat-title">Open Complaints</div>
                                <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="openComplaints">0</div>
                            <div class="stat-change">
                                <i class="fas fa-clock"></i>
                                <span>Needs attention</span>
                            </div>
                        </div>
                        
                        <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.4s;">
                            <div class="stat-header">
                                <div class="stat-title">Customer Satisfaction</div>
                                <div class="stat-icon" style="background: rgba(249, 115, 22, 0.1); color: var(--accent);">
                                    <i class="fas fa-star"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="customerSatisfaction">4.8</div>
                            <div class="stat-change">
                                <i class="fas fa-thumbs-up"></i>
                                <span>Average rating</span>
                            </div>
                        </div>
                    </div>

                    <!-- Customer List -->
                    <div class="card hover-lift animate-fadeInUp" style="animation-delay: 0.2s;">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Customer Database</h3>
                                <p class="card-subtitle">Manage customer information, orders, and communication history</p>
                            </div>
                        </div>
                        <div class="card-content" style="padding: 0;">
                            <div class="table-container">
                                <table class="table" id="customersTable">
                                    <thead>
                                        <tr>
                                            <th>Customer Details</th>
                                            <th>Contact Info</th>
                                            <th>Orders</th>
                                            <th>Total Spent</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTableBody">
                                        <tr>
                                            <td colspan="6">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon animate-float">
                                                        <i class="fas fa-users"></i>
                                                    </div>
                                                    <div class="empty-state-title">No customers registered yet</div>
                                                    <div class="empty-state-description">Add your first customer to start building your customer database.</div>
                                                    <button class="btn btn-primary btn-lg hover-glow" onclick="showAddCustomerModal()">
                                                        <i class="fas fa-user-plus"></i> Add First Customer
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Complaints Management Page -->
                <div id="complaintsContent" class="page-content hidden">
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Complaints Management</h3>
                                <p class="card-subtitle">Track and resolve customer complaints with advanced ticketing system</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="showAddComplaintModal()">
                                    <i class="fas fa-plus"></i> New Complaint
                                </button>
                                <button class="btn btn-sm btn-warning hover-glow" onclick="filterComplaints('urgent')">
                                    <i class="fas fa-exclamation-triangle"></i> Urgent
                                </button>
                                <button class="btn btn-sm btn-success hover-glow" onclick="filterComplaints('resolved')">
                                    <i class="fas fa-check"></i> Resolved
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <!-- Complaint Filters -->
                            <div class="customer-filters">
                                <div class="filter-chip active" onclick="filterComplaints('all')">All Complaints</div>
                                <div class="filter-chip" onclick="filterComplaints('pending')">Pending</div>
                                <div class="filter-chip" onclick="filterComplaints('urgent')">Urgent</div>
                                <div class="filter-chip" onclick="filterComplaints('resolved')">Resolved</div>
                                <div class="filter-chip" onclick="filterComplaints('product')">Product Issues</div>
                                <div class="filter-chip" onclick="filterComplaints('delivery')">Delivery Issues</div>
                            </div>

                            <!-- Complaints List -->
                            <div id="complaintsContainer">
                                <div class="empty-state">
                                    <div class="empty-state-icon animate-float">
                                        <i class="fas fa-clipboard-list"></i>
                                    </div>
                                    <div class="empty-state-title">No complaints registered</div>
                                    <div class="empty-state-description">Great! Your customers are happy. New complaints will appear here.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Tracking Page -->
                <div id="ordersContent" class="page-content hidden">
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Order Tracking & Management</h3>
                                <p class="card-subtitle">Real-time order tracking with delivery estimates and status updates</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="showAddOrderModal()">
                                    <i class="fas fa-plus"></i> New Order
                                </button>
                                <button class="btn btn-sm btn-info hover-glow" onclick="bulkUpdateOrders()">
                                    <i class="fas fa-edit"></i> Bulk Update
                                </button>
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="exportOrders()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <!-- Order Status Filters -->
                            <div class="customer-filters">
                                <div class="filter-chip active" onclick="filterOrders('all')">All Orders</div>
                                <div class="filter-chip" onclick="filterOrders('pending')">Pending</div>
                                <div class="filter-chip" onclick="filterOrders('processing')">Processing</div>
                                <div class="filter-chip" onclick="filterOrders('shipped')">Shipped</div>
                                <div class="filter-chip" onclick="filterOrders('delivered')">Delivered</div>
                                <div class="filter-chip" onclick="filterOrders('cancelled')">Cancelled</div>
                            </div>

                            <!-- Orders Grid -->
                            <div id="ordersContainer">
                                <div class="empty-state">
                                    <div class="empty-state-icon animate-float">
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <div class="empty-state-title">No orders to track</div>
                                    <div class="empty-state-description">Orders will appear here for tracking and management.</div>
                                    <button class="btn btn-primary btn-lg hover-glow" onclick="showAddOrderModal()">
                                        <i class="fas fa-plus"></i> Create First Order
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    
                <!-- Stock Management Page -->
                <div id="stockContent" class="page-content hidden">
                    <div id="lowStockAlert" class="hidden" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05)); border: 1px solid rgba(245, 158, 11, 0.2); color: var(--warning); padding: var(--spacing-lg); border-radius: var(--radius-lg); margin-bottom: var(--spacing-xl); display: flex; align-items: center; gap: var(--spacing);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem;"></i>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; font-size: 1rem;"> Critical Stock Alert!</div>
                            <div style="font-weight: 500; font-size: 0.875rem;">Multiple products are running critically low and require immediate attention.</div>
                        </div>
                        <button class="btn btn-sm btn-warning hover-glow" onclick="showLowStockItems()">
                            <i class="fas fa-eye"></i> View Critical Items
                        </button>
                    </div>

                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Advanced Product Management</h3>
                                <p class="card-subtitle">AI-powered inventory management with real-time tracking and analytics</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="clearProductForm()">
                                    <i class="fas fa-eraser"></i> Clear Form
                                </button>
                                <button class="btn btn-sm btn-danger hover-glow" onclick="clearStock()">
                                    <i class="fas fa-trash-alt"></i> Clear All
                                </button>
                                <button class="btn btn-sm btn-info hover-glow" onclick="exportStock()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <form id="addProductForm">
                                <div class="form-grid">
                                    <div class="form-field">
                                        <label class="form-label" for="productName">
                                            <i class="fas fa-tag"></i> Product Name *
                                        </label>
                                        <input 
                                            type="text" 
                                            class="form-control" 
                                            id="productName" 
                                            placeholder="Enter product name" 
                                            required
                                        >
                                        <div class="form-error hidden" id="productName-error"></div>
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="form-label" for="productPrice">
                                            <i class="fas fa-rupee-sign"></i> Price () *
                                        </label>
                                        <input 
                                            type="number" 
                                            class="form-control" 
                                            id="productPrice" 
                                            placeholder="0.00" 
                                            step="0.01" 
                                            min="0" 
                                            required
                                        >
                                        <div class="form-error hidden" id="productPrice-error"></div>
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="form-label" for="productQuantity">
                                            <i class="fas fa-cubes"></i> Quantity *
                                        </label>
                                        <input 
                                            type="number" 
                                            class="form-control" 
                                            id="productQuantity" 
                                            placeholder="0" 
                                            min="0" 
                                            required
                                        >
                                        <div class="form-error hidden" id="productQuantity-error"></div>
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="form-label" for="productCategory">
                                            <i class="fas fa-folder"></i> Category
                                        </label>
                                        <select class="form-control" id="productCategory">
                                            <option value="General"> General</option>
                                            <option value="Electronics"> Electronics</option>
                                            <option value="Clothing"> Clothing</option>
                                            <option value="Food & Beverages"> Food & Beverages</option>
                                            <option value="Books & Stationery"> Books & Stationery</option>
                                            <option value="Health & Beauty"> Health & Beauty</option>
                                            <option value="Sports & Outdoors"> Sports & Outdoors</option>
                                            <option value="Home & Garden"> Home & Garden</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-field">
                                        <label class="form-label" for="productSKU">
                                            <i class="fas fa-barcode"></i> SKU
                                        </label>
                                        <input 
                                            type="text" 
                                            class="form-control" 
                                            id="productSKU" 
                                            placeholder="Auto-generated"
                                            readonly
                                            style="background: var(--gray-50); color: var(--gray-600);"
                                        >
                                        <div class="form-help">Stock Keeping Unit (auto-generated)</div>
                                    </div>
                                    
                                    <div class="form-field" style="grid-column: 1 / -1;">
                                        <label class="form-label" for="productDescription">
                                            <i class="fas fa-align-left"></i> Description
                                        </label>
                                        <textarea 
                                            class="form-control" 
                                            id="productDescription" 
                                            placeholder="Product description (optional)"
                                            rows="3"
                                        ></textarea>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: var(--spacing); flex-wrap: wrap; margin-top: var(--spacing-lg);">
                                    <button type="submit" class="btn btn-primary hover-glow">
                                        <i class="fas fa-plus-circle"></i>
                                        Add to Inventory
                                    </button>
                                    <button type="button" class="btn btn-secondary hover-glow" onclick="clearProductForm()">
                                        <i class="fas fa-eraser"></i>
                                        Clear Form
                                    </button>
                                    <button type="button" class="btn btn-info hover-glow" onclick="exportStock()">
                                        <i class="fas fa-download"></i>
                                        Export CSV
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card hover-lift animate-fadeInUp" style="animation-delay: 0.2s;">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Product Inventory Analytics</h3>
                                <p class="card-subtitle">Real-time inventory monitoring with advanced stock analytics</p>
                            </div>
                        </div>
                        <div class="card-content" style="padding: 0;">
                            <div class="table-container">
                                <table class="table" id="stockTable">
                                    <thead>
                                        <tr>
                                            <th>Product Details</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Status</th>
                                            <th>SKU</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stockTableBody">
                                        <tr>
                                            <td colspan="7">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon animate-float">
                                                        <i class="fas fa-box-open"></i>
                                                    </div>
                                                    <div class="empty-state-title">No products in inventory</div>
                                                    <div class="empty-state-description">Start building your inventory with our advanced product management system.</div>
                                                    <button class="btn btn-primary btn-lg hover-glow" onclick="document.getElementById('productName').focus()">
                                                        <i class="fas fa-plus-circle"></i> Add Your First Product
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Smart Cart Page -->
                <div id="cartContent" class="page-content hidden">
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> AI-Powered Smart Cart</h3>
                                <p class="card-subtitle">Intelligent product search with real-time recommendations and analytics</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-secondary hover-glow
" onclick="saveCart()">
                                    <i class="fas fa-bookmark"></i> Save Cart
                                </button>
                                <button class="btn btn-sm btn-danger hover-glow" onclick="clearCart()">
                                    <i class="fas fa-trash-alt"></i> Clear Cart
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="search-filters">
                                <div class="search-input" style="position: relative;">
                                    <input 
                                        type="text" 
                                        id="cartSearch" 
                                        placeholder=" AI-powered product search..." 
                                        oninput="searchProducts()"
                                        onkeydown="handleSearchKeydown(event)"
                                        autocomplete="off"
                                    >
                                    <div id="productSuggestions" class="suggestions-container hidden"></div>
                                </div>
                                <button class="btn btn-primary hover-glow" onclick="quickAddToCart()">
                                    <i class="fas fa-plus-circle"></i> Quick Add
                                </button>
                            </div>
                            <div class="form-help">
                                 Use advanced search with keyboard navigation. Press Enter to add, arrow keys to navigate suggestions
                            </div>
                        </div>
                    </div>

                    <div class="card hover-lift animate-fadeInUp" style="animation-delay: 0.2s;">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Smart Shopping Cart</h3>
                                <p class="card-subtitle">Advanced cart management with real-time calculations and analytics</p>
                            </div>
                        </div>
                        <div class="card-content" style="padding: 0;">
                            <div class="table-container">
                                <table class="table" id="cartTable">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Total</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cartTableBody">
                                        <tr>
                                            <td colspan="5">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon animate-float">
                                                        <i class="fas fa-shopping-cart"></i>
                                                    </div>
                                                    <div class="empty-state-title">Your smart cart is empty</div>
                                                    <div class="empty-state-description">Use the AI-powered search above to find and add products.</div>
                                                    <button class="btn btn-primary btn-lg hover-glow" onclick="document.getElementById('cartSearch').focus()">
                                                        <i class="fas fa-search"></i> Start Smart Shopping
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="invoice-totals" id="cartSummary" style="display: none; margin: var(--spacing-xl);">
                                <div class="invoice-total-row">
                                    <span>Subtotal:</span>
                                    <span id="cartSubtotal">0.00</span>
                                </div>
                                <div class="invoice-total-row">
                                    <span>Tax (GST 18%):</span>
                                    <span id="cartTax">0.00</span>
                                </div>
                                <div class="invoice-total-row final">
                                    <span>Total Amount:</span>
                                    <span id="cartTotal">0.00</span>
                                </div>
                                <div style="display: flex; gap: var(--spacing); margin-top: var(--spacing-lg); flex-wrap: wrap;">
                                    <button class="btn btn-success btn-lg hover-glow" onclick="proceedToCheckout()" style="flex: 1; min-width: 180px;">
                                        <i class="fas fa-credit-card"></i> Proceed to Checkout
                                    </button>
                                    <button class="btn btn-secondary hover-glow" onclick="printQuote()">
                                        <i class="fas fa-print"></i> Print
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Business Analytics Page -->
                <div id="analyticsContent" class="page-content hidden">
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Business Intelligence Analytics</h3>
                                <p class="card-subtitle">PowerBI-style analytics dashboard with comprehensive business insights</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="refreshAnalytics()">
                                    <i class="fas fa-sync-alt"></i> Refresh Data
                                </button>
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="exportAnalytics()">
                                    <i class="fas fa-download"></i> Export Report
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <!-- Business Analytics KPI Grid -->
                            <div class="stats-grid">
                                <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.1s;">
                                    <div class="stat-header">
                                        <div class="stat-title">Total Revenue</div>
                                        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
                                            <i class="fas fa-chart-line animate-pulse"></i>
                                        </div>
                                    </div>
                                    <div class="stat-value" id="totalRevenue">0</div>
                                    <div class="stat-change">
                                        <i class="fas fa-arrow-up" style="color: var(--success);"></i>
                                        <span>+15% from last month</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.2s;">
                                    <div class="stat-header">
                                        <div class="stat-title">Total Orders</div>
                                        <div class="stat-icon" style="background: rgba(37, 99, 235, 0.1); color: var(--primary);">
                                            <i class="fas fa-shopping-bag"></i>
                                        </div>
                                    </div>
                                    <div class="stat-value" id="totalOrders">0</div>
                                    <div class="stat-change">
                                        <i class="fas fa-arrow-up" style="color: var(--success);"></i>
                                        <span>+8% growth rate</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.3s;">
                                    <div class="stat-header">
                                        <div class="stat-title">Inventory Turnover</div>
                                        <div class="stat-icon" style="background: rgba(249, 115, 22, 0.1); color: var(--accent);">
                                            <i class="fas fa-sync-alt animate-spin" style="animation-duration: 3s;"></i>
                                        </div>
                                    </div>
                                    <div class="stat-value" id="inventoryTurnover">2.4x</div>
                                    <div class="stat-change">
                                        <i class="fas fa-chart-line" style="color: var(--success);"></i>
                                        <span>Optimal performance</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card hover-lift animate-bounceIn" style="animation-delay: 0.4s;">
                                    <div class="stat-header">
                                        <div class="stat-title">Profit Margin</div>
                                        <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
                                            <i class="fas fa-percentage"></i>
                                        </div>
                                    </div>
                                    <div class="stat-value" id="profitMargin">24%</div>
                                    <div class="stat-change">
                                        <i class="fas fa-arrow-up" style="color: var(--success);"></i>
                                        <span>+3% improvement</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Charts Grid -->
                            <div class="analytics-grid">
                                <div class="chart-container hover-lift animate-fadeInUp" style="animation-delay: 0.5s;">
                                    <div class="chart-title">
                                        <i class="fas fa-chart-area animate-pulse"></i>
                                        Revenue Trend Analysis
                                    </div>
                                    <canvas id="revenueChart" width="400" height="250"></canvas>
                                </div>
                                
                                <div class="kpi-grid">
                                    <div class="kpi-card hover-lift" style="animation-delay: 0.6s;">
                                        <div class="kpi-header">
                                            <div class="kpi-title">Peak Sales Hour</div>
                                            <div class="kpi-icon" style="background: rgba(37, 99, 235, 0.1); color: var(--primary);">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                        </div>
                                        <div class="kpi-value">2:00 PM</div>
                                        <div class="kpi-change positive">
                                            <i class="fas fa-fire"></i>
                                            <span>Peak performance</span>
                                        </div>
                                    </div>
                                    
                                    <div class="kpi-card hover-lift" style="animation-delay: 0.7s;">
                                        <div class="kpi-header">
                                            <div class="kpi-title">Customer Satisfaction</div>
                                            <div class="kpi-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
                                                <i class="fas fa-smile"></i>
                                            </div>
                                        </div>
                                        <div class="kpi-value">4.8/5</div>
                                        <div class="kpi-change positive">
                                            <i class="fas fa-star"></i>
                                            <span>Excellent rating</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Second Row Charts -->
                            <div class="analytics-grid">
                                <div class="chart-container hover-lift animate-fadeInUp" style="animation-delay: 0.8s;">
                                    <div class="chart-title">
                                        <i class="fas fa-chart-pie animate-spin" style="animation-duration: 6s;"></i>
                                        Product Performance
                                    </div>
                                    <canvas id="productChart" width="400" height="250"></canvas>
                                </div>
                                
                                <div class="chart-container hover-lift animate-fadeInUp" style="animation-delay: 0.9s;">
                                    <div class="chart-title">
                                        <i class="fas fa-chart-bar animate-pulse"></i>
                                        Monthly Comparison
                                    </div>
                                    <canvas id="monthlyChart" width="400" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reportsContent" class="page-content hidden">
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Advanced Business Reports</h3>
                                <p class="card-subtitle">Comprehensive reporting system with automated insights and recommendations</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="generateReport()">
                                    <i class="fas fa-file-chart-line"></i> Generate Report
                                </button>
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="scheduleReport()">
                                    <i class="fas fa-calendar-alt"></i> Schedule
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="empty-state">
                                <div class="empty-state-icon animate-float">
                                    <i class="fas fa-file-chart-line"></i>
                                </div>
                                <div class="empty-state-title">Advanced Reports Coming Soon</div>
                                <div class="empty-state-description">Comprehensive business intelligence reports with automated insights, trend analysis, and predictive analytics powered by AI.</div>
                                <button class="btn btn-primary btn-lg hover-glow" onclick="showPage('analytics')">
                                    <i class="fas fa-chart-pie"></i> View Analytics Dashboard
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invoice Generator Page -->
                <div id="invoiceContent" class="page-content hidden">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-xl);">
                        <div class="card hover-lift animate-fadeIn">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title"> Customer Information</h3>
                                    <p class="card-subtitle">Enhanced customer data management for professional invoicing</p>
                                </div>
                            </div>
                            <div class="card-content">
                                <form id="invoiceForm">
                                    <div class="form-field">
                                        <label class="form-label" for="customerName">
                                            <i class="fas fa-user"></i> Customer Name *
                                        </label>
                                        <input 
                                            type="text" 
                                            class="form-control" 
                                            id="customerName" 
                                            placeholder="Enter customer name" 
                                            required
                                            oninput="updateInvoicePreview()"
                                        >
                                        <div class="form-error hidden" id="customerName-error"></div>
                                    </div>
                                    <div class="form-field">
                                        <label class="form-label" for="customerPhone">
                                            <i class="fas fa-phone"></i> Phone Number
                                        </label>
                                        <input 
                                            type="tel" 
                                            class="form-control" 
                                            id="customerPhone" 
                                            placeholder="+91 XXXXX XXXXX"
                                            oninput="updateInvoicePreview()"
                                        >
                                    </div>
                                    <div class="form-field">
                                        <label class="form-label" for="customerEmail">
                                            <i class="fas fa-envelope"></i> Email
                                        </label>
                                        <input 
                                            type="email" 
                                            class="form-control" 
                                            id="customerEmail" 
                                            placeholder="customer@example.com"
                                            oninput="updateInvoicePreview()"
                                        >
                                    </div>
                                    <div class="form-field">
                                        <label class="form-label" for="customerAddress">
                                            <i class="fas fa-map-marker-alt"></i> Address
                                        </label>
                                        <textarea 
                                            class="form-control" 
                                            id="customerAddress" 
                                            rows="3" 
                                            placeholder="Customer address"
                                            oninput="updateInvoicePreview()"
                                        ></textarea>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="card hover-lift animate-fadeIn">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title"> Invoice Configuration</h3>
                                    <p class="card-subtitle">Advanced invoice settings and customization options</p>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="form-field">
                                    <label class="form-label" for="invoiceNumber">
                                        <i class="fas fa-hashtag"></i> Invoice Number
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="invoiceNumber" 
                                        placeholder="Auto-generated" 
                                        readonly
                                        style="background: var(--gray-50); color: var(--gray-600);"
                                    >
                                    <div class="form-help">Automatically generated with smart numbering</div>
                                </div>
                                <div class="form-field">
                                    <label class="form-label" for="invoiceDate">
                                        <i class="fas fa-calendar"></i> Invoice Date
                                    </label>
                                    <input 
                                        type="date" 
                                        class="form-control" 
                                        id="invoiceDate"
                                        onchange="updateInvoicePreview()"
                                    >
                                </div>
                                <div class="form-field">
                                    <label class="form-label" for="paymentMethod">
                                        <i class="fas fa-credit-card"></i> Payment Method
                                    </label>
                                    <select class="form-control" id="paymentMethod" onchange="updateInvoicePreview()">
                                        <option value="cash"> Cash</option>
                                        <option value="card"> Credit/Debit Card</option>
                                        <option value="upi"> UPI</option>
                                        <option value="netbanking"> Net Banking</option>
                                        <option value="cheque"> Cheque</option>
                                    </select>
                                </div>
                                <div class="form-field">
                                    <label class="form-label" for="invoiceNotes">
                                        <i class="fas fa-sticky-note"></i> Notes
                                    </label>
                                    <textarea 
                                        class="form-control" 
                                        id="invoiceNotes" 
                                        rows="3" 
                                        placeholder="Thank you for your business!"
                                        oninput="updateInvoicePreview()"
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Invoice Preview -->
                    <div class="invoice-preview animate-fadeInUp" id="invoicePreview" style="animation-delay: 0.4s;">
                        <div class="invoice-header">
                            <img src="images.jpg" alt="Kings Mart Logo" class="invoice-logo">
                            <div class="invoice-company-name">KINGS MART PROFESSIONAL</div>
                            <div style="color: var(--gray-600); font-weight: 500; margin-bottom: var(--spacing-lg); font-size: 0.875rem;">
                                Advanced Analytics & Customer Management System
                            </div>
                            <div class="invoice-number">Invoice #<span id="previewInvoiceNumber">INV-001</span></div>
                            <div class="invoice-date">Date: <span id="previewDate">Today</span></div>
                        </div>

                        <div class="invoice-details">
                            <div class="invoice-section">
                                <div class="invoice-section-title"> Bill To:</div>
                                <div class="invoice-section-content" id="previewCustomerDetails">
                                    <div><strong>Customer Name</strong></div>
                                    <div> Phone: Not provided</div>
                                    <div> Email: Not provided</div>
                                    <div> Address: Not provided</div>
                                </div>
                            </div>
                            
                            <div class="invoice-section">
                                <div class="invoice-section-title"> Bill From:</div>
                                <div class="invoice-section-content">
                                    <div><strong>Kings Mart Professional</strong></div>
                                    <div> 123 Business Street</div>
                                    <div> City, State - 123456</div>
                                    <div> Phone: +91 98765 43210</div>
                                    <div> Email: info@kingsmart.com</div>
                                    <div> Website: www.kingsmart.com</div>
                                </div>
                            </div>
                        </div>

                        <div class="table-container" style="margin: var(--spacing-lg) 0;">
                            <table class="table" id="invoiceItemsTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Item Description</th>
                                        <th style="text-align: center;">Qty</th>
                                        <th style="text-align: right;">Unit Price</th>
                                        <th style="text-align: right;">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="invoiceItemsBody">
                                    <tr>
                                        <td colspan="4">
                                            <div class="empty-state">
                                                <div class="empty-state-icon animate-float">
                                                    <i class="fas fa-clipboard-list"></i>
                                                </div>
                                                <div class="empty-state-title">No items in cart</div>
                                                <div class="empty-state-description">Add items to cart to generate invoice.</div>
                                                <button class="btn btn-primary hover-glow" onclick="showPage('cart')">
                                                    <i class="fas fa-shopping-cart"></i> Go to Smart Cart
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr auto; gap: var(--spacing-xl); align-items: start; padding: var(--spacing-lg);">
                            <div>
                                <div class="invoice-section">
                                    <div class="invoice-section-title"> Terms & Conditions:</div>
                                    <div class="invoice-section-content" style="font-size: 0.8125rem; line-height: 1.6;">
                                        <ol style="margin: 0; padding-left: var(--spacing-lg);">
                                            <li>Payment is due upon receipt of invoice.</li>
                                            <li>Late payments may incur additional charges.</li>
                                            <li>Goods once sold cannot be returned without agreement.</li>
                                            <li>All prices include applicable taxes unless stated.</li>
                                        </ol>
                                    </div>
                                </div>
                                
                                <div style="margin-top: var(--spacing);">
                                    <div class="invoice-section-title"> Notes:</div>
                                    <div id="previewNotes" style="color: var(--gray-600); font-size: 0.8125rem; line-height: 1.6;">
                                        Thank you for choosing Kings Mart Professional!
                                    </div>
                                </div>
                            </div>
                            
                            <div class="invoice-totals" style="min-width: 280px;">
                                <div class="invoice-total-row">
                                    <span>Subtotal:</span>
                                    <span id="previewSubtotal">0.00</span>
                                </div>
                                <div class="invoice-total-row">
                                    <span>Tax (GST 18%):</span>
                                    <span id="previewTax">0.00</span>
                                </div>
                                <div class="invoice-total-row final">
                                    <span>Grand Total:</span>
                                    <span id="previewTotal">0.00</span>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: var(--spacing); margin-top: var(--spacing-lg); justify-content: center; flex-wrap: wrap; padding: var(--spacing-lg);">
                            <button class="btn btn-success btn-xl hover-glow" onclick="generateInvoice()" id="generateBtn" disabled>
                                <i class="fas fa-file-invoice-dollar"></i> Generate & Download Invoice
                            </button>
                            <button class="btn btn-secondary btn-lg hover-glow" onclick="printInvoice()">
                                <i class="fas fa-print"></i> Print Preview
                            </button>
                            <button class="btn btn-info btn-lg hover-glow" onclick="saveAsDraft()">
                                <i class="fas fa-save"></i> Save Draft
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Invoice History Page -->
                <div id="invoicesContent" class="page-content hidden">
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Invoice History & Analytics</h3>
                                <p class="card-subtitle">Comprehensive invoice management with advanced search and analytics</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-sm btn-info hover-glow" onclick="filterInvoices()">
                                    <i class="fas fa-filter"></i> Advanced Filter
                                </button>
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="exportInvoices()">
                                    <i class="fas fa-download"></i> Export All
                                </button>
                            </div>
                        </div>
                        <div class="card-content" style="padding: 0;">
                            <div class="table-container">
                                <table class="table" id="invoicesTable">
                                    <thead>
                                        <tr>
                                            <th>Invoice #</th>
                                            <th>Customer</th>
                                            <th>Date</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="invoicesTableBody">
                                        <tr>
                                            <td colspan="6">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon animate-float">
                                                        <i class="fas fa-file-invoice"></i>
                                                    </div>
                                                    <div class="empty-state-title">No invoices generated yet</div>
                                                    <div class="empty-state-description">Generate your first invoice to see comprehensive analytics here.</div>
                                                    <button class="btn btn-primary btn-lg hover-glow" onclick="showPage('invoice')">
                                                        <i class="fas fa-file-invoice"></i> Generate First Invoice
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Settings Page -->
                <div id="settingsContent" class="page-content hidden">
                    <div class="card hover-lift animate-fadeInUp">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title"> Advanced System Configuration</h3>
                                <p class="card-subtitle">Comprehensive system settings with business intelligence and customer management customization</p>
                            </div>
                            <button class="btn btn-sm btn-success hover-glow" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Save All Settings
                            </button>
                        </div>
                        <div class="card-content">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: var(--spacing-2xl);">
                                <div class="card hover-lift">
                                    <div class="card-header">
                                        <div>
                                            <h4 class="card-title" style="font-size: 1.125rem;"> Business Information</h4>
                                            <p class="card-subtitle">Update your business details and branding</p>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <div class="form-field">
                                            <label class="form-label">Business Name</label>
                                            <input type="text" class="form-control" id="settingsBusinessName" value="Kings Mart Professional">
                                        </div>
                                        <div class="form-field">
                                            <label class="form-label">Business Address</label>
                                            <textarea class="form-control" id="settingsBusinessAddress" rows="3">123 Business Street, City, State - 123456</textarea>
                                        </div>
                                        <div class="form-field">
                                            <label class="form-label">Phone Number</label>
                                            <input type="tel" class="form-control" id="settingsBusinessPhone" value="+91 98765 43210">
                                        </div>
                                        <div class="form-field">
                                            <label class="form-label">Email Address</label>
                                            <input type="email" class="form-control" id="settingsBusinessEmail" value="info@kingsmart.com">
                                        </div>
                                    </div>
                                </div>

                                <div class="card hover-lift">
                                    <div class="card-header">
                                        <div>
                                            <h4 class="card-title" style="font-size: 1.125rem;"> System Preferences</h4>
                                            <p class="card-subtitle">Configure system behavior and analytics</p>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <div class="form-field">
                                            <label class="form-label">Low Stock Threshold</label>
                                            <input type="number" class="form-control" id="settingsLowStockThreshold" value="10" min="1">
                                            <div class="form-help">Alert when quantity falls below this number</div>
                                        </div>
                                        <div class="form-field">
                                            <label class="form-label">Tax Rate (%)</label>
                                            <input type="number" class="form-control" id="settingsTaxRate" value="18" min="0" step="0.01">
                                            <div class="form-help">Default tax rate for invoices (GST)</div>
                                        </div>
                                        <div class="form-field">
                                            <label class="form-label">Currency Symbol</label>
                                            <select class="form-control" id="settingsCurrency">
                                                <option value=""> (Indian Rupee)</option>
                                                <option value="$">$ (US Dollar)</option>
                                                <option value=""> (Euro)</option>
                                                <option value=""> (British Pound)</option>
                                            </select>
                                        </div>
                                        <div class="form-field" style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                            <input type="checkbox" id="settingsAutoSave" checked>
                                            <label class="form-label" for="settingsAutoSave" style="margin: 0;">Auto-save Data</label>
                                        </div>
                                        <div class="form-help">Automatically save changes every 30 seconds</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Data Management Section -->
                            <div class="card hover-lift" style="margin-top: var(--spacing-2xl);">
                                <div class="card-header">
                                    <div>
                                        <h4 class="card-title" style="font-size: 1.125rem;"> Advanced Data Management</h4>
                                        <p class="card-subtitle">Comprehensive backup, analytics, and data management tools</p>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--spacing);">
                                        <button class="btn btn-info hover-glow" onclick="exportAllData()">
                                            <i class="fas fa-download"></i> Export All Data
                                            <button onclick="exportTableToCSV('customersTable', 'customers.csv')">Export Customers CSV</button>
                                        </button>
                                        <button class="btn btn-secondary hover-glow" onclick="importData()">
                                            <i class="fas fa-upload"></i> Import Data
                                        </button>
                                        <button class="btn btn-warning hover-glow" onclick="createBackup()">
                                            <i class="fas fa-shield-alt"></i> Create Backup
                                        </button>
                                        <button class="btn btn-danger hover-glow" onclick="resetAllData()">
                                            <i class="fas fa-exclamation-triangle"></i> Reset System
                                        </button>
                                    </div>
                                    <button class="btn btn-danger hover-glow" onclick="logout()" style="width: 100%; margin-top: 1rem;">
  <i class="fas fa-sign-out-alt"></i> Logout
</button>

                                    <!-- Enhanced Statistics Dashboard */-->
                                    <div style="margin-top: var(--spacing-xl); padding: var(--spacing-xl); background: linear-gradient(135deg, var(--gray-50), rgba(37, 99, 235, 0.02)); border-radius: var(--radius-lg); border: 1px solid var(--gray-200);">
                                        <h5 class="font-bold mb-3" style="color: var(--gray-900); display: flex; align-items: center; gap: var(--spacing-sm);">
                                            <i class="fas fa-chart-pie animate-spin" style="color: var(--primary); animation-duration: 4s;"></i>
                                            Business Intelligence Dashboard
                                        </h5>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing);">
                                            <div style="text-align: center; padding: var(--spacing); background: var(--white); border-radius: var(--radius-lg); border: 1px solid var(--gray-200);" class="hover-lift">
                                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary);" id="statsProducts">0</div>
                                                <div style="font-size: 0.8125rem; color: var(--gray-600); font-weight: 600;">Total Products</div>
                                                <div class="progress-bar" style="margin-top: var(--spacing-xs);">
                                                    <div class="progress-fill" style="width: 75%;"></div>
                                                </div>
                                            </div>
                                            <div style="text-align: center; padding: var(--spacing); background: var(--white); border-radius: var(--radius-lg); border: 1px solid var(--gray-200);" class="hover-lift">
                                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--success);" id="statsInvoices">0</div>
                                                <div style="font-size: 0.8125rem; color: var(--gray-600); font-weight: 600;">Total Invoices</div>
                                                <div class="progress-bar" style="margin-top: var(--spacing-xs);">
                                                    <div class="progress-fill" style="width: 60%; background: var(--gradient-success);"></div>
                                                </div>
                                            </div>
                                            <div style="text-align: center; padding: var(--spacing); background: var(--white); border-radius: var(--radius-lg); border: 1px solid var(--gray-200);" class="hover-lift">
                                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--warning);" id="statsRevenue">0</div>
                                                <div style="font-size: 0.8125rem; color: var(--gray-600); font-weight: 600;">Total Revenue</div>
                                                <div class="progress-bar" style="margin-top: var(--spacing-xs);">
                                                    <div class="progress-fill" style="width: 85%; background: var(--gradient-warning);"></div>
                                                </div>
                                            </div>
                                            <div style="text-align: center; padding: var(--spacing); background: var(--white); border-radius: var(--radius-lg); border: 1px solid var(--gray-200);" class="hover-lift">
                                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent);" id="statsCustomersSettings">0</div>
                                                <div style="font-size: 0.8125rem; color: var(--gray-600); font-weight: 600;">Total Customers</div>
                                                <div class="progress-bar" style="margin-top: var(--spacing-xs);">
                                                    <div class="progress-fill" style="width: 100%; background: linear-gradient(135deg, var(--accent), var(--warning));"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"> Add New Customer</h3>
                <button class="modal-close hover-glow" onclick="closeAddCustomerModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addCustomerForm">
                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label" for="customerFullName">
                                <i class="fas fa-user"></i> Full Name *
                            </label>
                            <input type="text" class="form-control" id="customerFullName" placeholder="Enter full name" required>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label" for="customerEmailAddr">
                                <i class="fas fa-envelope"></i> Email Address *
                            </label>
                            <input type="email" class="form-control" id="customerEmailAddr" placeholder="customer@example.com" required>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label" for="customerPhoneNum">
                                <i class="fas fa-phone"></i> Phone Number *
                            </label>
                            <input type="tel" class="form-control" id="customerPhoneNum" placeholder="+91 XXXXX XXXXX" required>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label" for="customerType">
                                <i class="fas fa-crown"></i> Customer Type
                            </label>
                            <select class="form-control" id="customerType">
                                <option value="regular"> Regular</option>
                                <option value="vip"> VIP</option>
                                <option value="wholesale"> Wholesale</option>
                            </select>
                        </div>
                        
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label class="form-label" for="customerAddr">
                                <i class="fas fa-map-marker-alt"></i> Address
                            </label>
                            <textarea class="form-control" id="customerAddr" rows="3" placeholder="Complete address"></textarea>
                        </div>
                        
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label class="form-label" for="customerNotes">
                                <i class="fas fa-sticky-note"></i> Notes
                            </label>
                            <textarea class="form-control" id="customerNotes" rows="2" placeholder="Additional notes about customer"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary hover-glow" onclick="closeAddCustomerModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary hover-glow" onclick="addCustomer()">
                    <i class="fas fa-user-plus"></i> Add Customer
                </button>
            </div>
        </div>
    </div>

    <!-- Add Complaint Modal -->
    <div id="addComplaintModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"> Register New Complaint</h3>
                <button class="modal-close hover-glow" onclick="closeAddComplaintModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addComplaintForm">
                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label" for="complaintCustomer">
                                <i class="fas fa-user"></i> Customer *
                            </label>
                            <select class="form-control" id="complaintCustomer" required>
                                <option value="">Select Customer</option>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label" for="complaintType">
                                <i class="fas fa-tag"></i> Complaint Type *
                            </label>
                            <select class="form-control" id="complaintType" required>
                                <option value="">Select Type</option>
                                <option value="product"> Product Issue</option>
                                <option value="delivery"> Delivery Issue</option>
                                <option value="service"> Service Issue</option>
                                <option value="billing"> Billing Issue</option>
                                <option value="other"> Other</option>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label" for="complaintPriority">
                                <i class="fas fa-exclamation"></i> Priority
                            </label>
                            <select class="form-control" id="complaintPriority">
                                <option value="low"> Low</option>
                                <option value="medium" selected> Medium</option>
                                <option value="high"> High</option>
                                <option value="urgent"> Urgent</option>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label" for="complaintOrderId">
                                <i class="fas fa-receipt"></i> Related Order ID
                            </label>
                            <input type="text" class="form-control" id="complaintOrderId" placeholder="Optional">
                        </div>
                        
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label class="form-label" for="complaintSubject">
                                <i class="fas fa-heading"></i> Subject *
                            </label>
                            <input type="text" class="form-control" id="complaintSubject" placeholder="Brief description of the issue" required>
                        </div>
                        
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label class="form-label" for="complaintDescription">
                                <i class="fas fa-align-left"></i> Detailed Description *
                            </label>
                            <textarea class="form-control" id="complaintDescription" rows="4" placeholder="Provide detailed description of the complaint" required></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary hover-glow" onclick="closeAddComplaintModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary hover-glow" onclick="addComplaint()">
                    <i class="fas fa-plus"></i> Register Complaint
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Modal System -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Confirm Action</h3>
                <button class="modal-close hover-glow" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary hover-glow" onclick="closeModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary hover-glow" id="modalConfirmBtn" onclick="confirmModal()">
                    <i class="fas fa-check"></i> Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Enhanced Global App State with Customer Management
        let appState = {
            user: null,
            theme: localStorage.getItem('theme') || 'light',
            sidebarCollapsed: localStorage.getItem('sidebarCollapsed') === 'true',
            currentPage: 'dashboard',
            stock: JSON.parse(localStorage.getItem('stock') || '[]'),
            cart: JSON.parse(localStorage.getItem('cart') || '[]'),
            invoices: JSON.parse(localStorage.getItem('invoices') || '[]'),
            customers: JSON.parse(localStorage.getItem('customers') || '[]'),
            complaints: JSON.parse(localStorage.getItem('complaints') || '[]'),
            orders: JSON.parse(localStorage.getItem('orders') || '[]'),
            analytics: JSON.parse(localStorage.getItem('analytics') || '{}'),
            searchIndex: 0,
            productSuggestions: [],
            currentModal: null,
            charts: {},
            customerFilter: 'all',
            complaintFilter: 'all',
            orderFilter: 'all',
            settings: JSON.parse(localStorage.getItem('settings') || JSON.stringify({
                lowStockThreshold: 10,
                taxRate: 18,
                currency: '',
                businessName: 'Kings Mart Professional',
                businessAddress: '123 Business Street, City, State - 123456',
                businessPhone: '+91 98765 43210',
                businessEmail: 'info@kingsmart.com',
                autoSave: true
            })),
            isLoading: false,
            particlesInitialized: false
        };

        // Enhanced App Initialization
        document.addEventListener('DOMContentLoaded', function() {
            showLoadingScreen();
            setTimeout(() => {
                initializeApp();
                initializeParticles();
                setupKeyboardShortcuts();
                setupAdvancedAnimations();
            }, 1000);
        });

        // Enhanced Loading Screen
        function showLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            const progressBar = document.getElementById('loadingProgressBar');
            
            loadingScreen.classList.remove('hidden');
            
            let progress = 0;
            const loadingSteps = [
                'Initializing system...',
                'Loading business intelligence...',
                'Setting up customer management...',
                'Configuring charts and visuals...',
                'Preparing dashboard...',
                'Loading demo data...',
                'Finalizing setup...'
            ];
            
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 10;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                
                const stepIndex = Math.floor((progress / 100) * loadingSteps.length);
                const loadingTexts = document.querySelectorAll('.loading-text');
                const loadingText = loadingTexts[loadingTexts.length - 1];
                if (loadingText && stepIndex < loadingSteps.length) {
                    loadingText.textContent = loadingSteps[stepIndex];
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        showLoginPage();
                    }, 800);
                }
            }, 200);
        }

        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
        }

        // Initialize Particles Background
        function initializeParticles() {
            if (typeof particlesJS !== 'undefined' && !appState.particlesInitialized) {
                particlesJS('particles-js', {
                    particles: {
                        number: {
                            value: 40,
                            density: { enable: true, value_area: 800 }
                        },
                        color: { value: '#2563eb' },
                        shape: {
                            type: 'circle',
                            stroke: { width: 0, color: '#000000' }
                        },
                        opacity: {
                            value: 0.08,
                            random: false,
                            anim: { enable: false }
                        },
                        size: {
                            value: 3,
                            random: true,
                            anim: { enable: false }
                        },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: '#2563eb',
                            opacity: 0.08,
                            width: 1
                        },
                        move: {
                            enable: true,
                            speed: 1.5,
                            direction: 'none',
                            random: false,
                            straight: false,
                            out_mode: 'out',
                            bounce: false
                        }
                    },
                    interactivity: {
                        detect_on: 'canvas',
                        events: {
                            onhover: { enable: true, mode: 'repulse' },
                            onclick: { enable: true, mode: 'push' },
                            resize: true
                        },
                        modes: {
                            repulse: { distance: 80, duration: 0.4 },
                            push: { particles_nb: 2 }
                        }
                    },
                    retina_detect: true
                });
                appState.particlesInitialized = true;
            }
        }

        // Enhanced App Initialization
        function initializeApp() {
            document.documentElement.setAttribute('data-theme', appState.theme);
            updateThemeIcon();
            
            if (appState.sidebarCollapsed) {
                document.getElementById('sidebar').classList.add('collapsed');
            }
            
            initializeInvoiceForm();
            updateDashboard();
            initializeCharts();
            
            if (appState.stock.length === 0) {
                setTimeout(loadEnhancedDemoData, 1500);
            }
            
            if (appState.customers.length === 0) {
                setTimeout(loadDemoCustomerData, 2000);
            }
            
            console.log(' Kings Mart Professional v2.1 - Customer Management System Initialized Successfully');
        }

        // Enhanced Login System
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const loading = document.getElementById('loginLoading');
            const buttonText = document.getElementById('loginButtonText');
            
            if (!username || !password) {
                showToast('Please enter both username and password', 'error');
                shakeElement(document.querySelector('.login-card'));
                return;
            }
            
            loading.classList.remove('hidden');
            buttonText.textContent = 'Authenticating...';
            
            setTimeout(() => {
                if (username === 'admin' && password === 'admin123') {
                    appState.user = { 
                        username, 
                        role: 'admin',
                        loginTime: new Date().toISOString()
                    };
                    
                    document.getElementById('userName').textContent = username;
                    document.getElementById('userAvatar').textContent = username.charAt(0).toUpperCase();
                    
                    animatePageTransition();
                    showToast(` Welcome back, ${username}! Customer management system ready.`, 'success', 5000);
                    playSuccessSound();
                } else {
                    showToast(' Invalid credentials. Try admin/admin123', 'error');
                    shakeElement(document.querySelector('.login-card'));
                }
                
                loading.classList.add('hidden');
                buttonText.textContent = 'Access Dashboard';
            }, 1500);
        });

        // Enhanced Success Sound
        function playSuccessSound() {
            if (appState.settings.soundEnabled !== false) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (error) {
                    console.log('Audio not available');
                }
            }
        }

        // Enhanced Page Transition
        function animatePageTransition() {
            const loginPage = document.getElementById('loginPage');
            const dashboardPage = document.getElementById('dashboardPage');
            
            loginPage.style.opacity = '0';
            loginPage.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                loginPage.classList.add('hidden');
                dashboardPage.classList.remove('hidden');
                dashboardPage.style.opacity = '0';
                dashboardPage.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    dashboardPage.style.opacity = '1';
                    dashboardPage.style.transform = 'scale(1)';
                    updateDashboard();
                    showWelcomeAnimation();
                    initializeCharts();
                }, 100);
            }, 400);
        }

        // Enhanced Welcome Animation
        function showWelcomeAnimation() {
            const elements = document.querySelectorAll('.stat-card, .quick-action, .card, .chart-container');
            elements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px) scale(0.95)';
                setTimeout(() => {
                    el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0) scale(1)';
                }, index * 100);
            });
        }

        // Enhanced Navigation System
        function showPage(page) {
            if (appState.isLoading) return;
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
            
            const currentPage = document.querySelector('[id$="Content"]:not(.hidden)');
            if (currentPage) {
                currentPage.style.opacity = '0';
                currentPage.style.transform = 'translateX(-20px)';
                setTimeout(() => {
                    currentPage.classList.add('hidden');
                }, 200);
            }
            
            setTimeout(() => {
                const pageContent = document.getElementById(page + 'Content');
                if (pageContent) {
                    pageContent.classList.remove('hidden');
                    pageContent.style.opacity = '0';
                    pageContent.style.transform = 'translateX(20px)';
                    
                    setTimeout(() => {
                        pageContent.style.opacity = '1';
                        pageContent.style.transform = 'translateX(0)';
                    }, 50);
                }
            }, 200);
            
            const titles = {
                dashboard: ' Analytics Dashboard',
                stock: ' Stock Management',
                cart: ' Smart Cart',
                invoice: ' Invoice Generator',
                invoices: ' Invoice History',
                analytics: ' Business Analytics',
                reports: ' Advanced Reports',
                settings: ' System Settings',
                customers: ' Customer Hub',
                complaints: ' Complaints Management',
                orders: ' Order Tracking'
            };
            
            const breadcrumbs = {
                dashboard: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> / Analytics Dashboard',
                stock: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Inventory / Stock Management',
                cart: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Sales / Smart Cart',
                invoice: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Sales / Invoice Generator',
                invoices: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Sales / Invoice History',
                analytics: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Business Intelligence / Analytics',
                reports: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Business Intelligence / Reports',
                settings: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  System Settings',
                customers: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Customer Management / Customer Hub',
                complaints: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Customer Management / Complaints',
                orders: '<a href="#" onclick="showPage(\'dashboard\')"> Home</a> /  Customer Management / Order Tracking'
            };
            
            document.getElementById('pageTitle').textContent = titles[page] || 'Unknown Page';
            document.getElementById('breadcrumb').innerHTML = breadcrumbs[page] || 'Home';
            
            appState.currentPage = page;
            
            switch(page) {
                case 'dashboard':
                    updateDashboard();
                    updateCharts();
                    break;
                case 'analytics':
                    updateAnalytics();
                    updateAdvancedCharts();
                    break;
                case 'stock':
                    renderStockTable();
                    checkLowStock();
                    setTimeout(() => document.getElementById('productName')?.focus(), 300);
                    break;
                case 'cart':
                    renderCartTable();
                    updateCartSummary();
                    setTimeout(() => document.getElementById('cartSearch')?.focus(), 300);
                    break;
                case 'invoice':
                    updateInvoicePreview();
                    setTimeout(() => document.getElementById('customerName')?.focus(), 300);
                    break;
                case 'invoices':
                    renderInvoicesTable();
                    break;
                case 'customers':
                    renderCustomersTable();
                    updateCustomerStats();
                    break;
                case 'complaints':
                    renderComplaints();
                    updateCustomerStats();
                    break;
                case 'orders':
                    renderOrders();
                    updateCustomerStats();
                    break;
                case 'settings':
                    updateSettingsStats();
                    break;
                case 'reports':
                    updateReports();
                    break;
            }
            
            showToast(` Navigated to ${titles[page]}`, 'info', 2000);
        }

        // Customer Management Functions
        function showAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.add('show');
        }

        function closeAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.remove('show');
            document.getElementById('addCustomerForm').reset();
        }

        function addCustomer() {
            const name = document.getElementById('customerFullName').value.trim();
            const email = document.getElementById('customerEmailAddr').value.trim();
            const phone = document.getElementById('customerPhoneNum').value.trim();
            const type = document.getElementById('customerType').value;
            const address = document.getElementById('customerAddr').value.trim();
            const notes = document.getElementById('customerNotes').value.trim();
            
            if (!name || !email || !phone) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Check for duplicate email
            if (appState.customers.find(c => c.email === email)) {
                showToast('Customer with this email already exists', 'error');
                return;
            }
            
            const customer = {
                id: Date.now() + Math.random(),
                name,
                email,
                phone,
                type,
                address,
                notes,
                totalOrders: 0,
                totalSpent: 0,
                status: 'active',
                registrationDate: new Date().toISOString(),
                lastOrderDate: null,
                satisfaction: 5.0
            };
            
            appState.customers.push(customer);
            saveAppState();
            renderCustomersTable();
            updateCustomerStats();
            updateDashboard();
            updateComplaintCustomerOptions();
            closeAddCustomerModal();
            
            showToast(` Customer ${name} added successfully!`, 'success');
        }

        function renderCustomersTable() {
            const tbody = document.getElementById('customersTableBody');
            
            if (appState.customers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="empty-state-icon animate-float">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="empty-state-title">No customers registered yet</div>
                                <div class="empty-state-description">Add your first customer to start building your customer database.</div>
                                <button class="btn btn-primary btn-lg hover-glow" onclick="showAddCustomerModal()">
                                    <i class="fas fa-user-plus"></i> Add First Customer
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let filteredCustomers = appState.customers;
            
            // Apply filters
            if (appState.customerFilter !== 'all') {
                filteredCustomers = appState.customers.filter(customer => {
                    switch (appState.customerFilter) {
                        case 'active': return customer.status === 'active';
                        case 'vip': return customer.type === 'vip';
                        case 'pending': return customer.totalOrders > 0;
                        case 'complaints': return appState.complaints.some(c => c.customerId === customer.id);
                        default: return true;
                    }
                });
            }
            
            tbody.innerHTML = filteredCustomers.map((customer, index) => {
                const typeEmoji = customer.type === 'vip' ? '' : customer.type === 'wholesale' ? '' : '';
                const statusClass = customer.status === 'active' ? 'success' : 'secondary';
                const customerComplaints = appState.complaints.filter(c => c.customerId === customer.id);
                
                return `
                    <tr class="hover-lift" style="animation-delay: ${index * 0.03}s;">
                        <td>
                            <div style="display: flex; align-items: center; gap: var(--spacing);">
                                <div class="customer-avatar">
                                    ${customer.name.charAt(0).toUpperCase()}
                                </div>
                                <div class="customer-info">
                                    <div class="customer-name">${typeEmoji} ${customer.name}</div>
                                    <div class="customer-details">
                                        Member since: ${new Date(customer.registrationDate).toLocaleDateString()}
                                        ${customer.lastOrderDate ? `<br>Last order: ${new Date(customer.lastOrderDate).toLocaleDateString()}` : ''}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 0.875rem;">
                                <div><i class="fas fa-envelope"></i> ${customer.email}</div>
                                <div style="margin-top: 0.25rem;"><i class="fas fa-phone"></i> ${customer.phone}</div>
                                ${customer.address ? `<div style="margin-top: 0.25rem;"><i class="fas fa-map-marker-alt"></i> ${customer.address.substring(0, 30)}...</div>` : ''}
                            </div>
                        </td>
                        <td>
                            <div style="text-align: center;">
                                <div style="font-weight: 700; font-size: 1.125rem; color: var(--primary);">${customer.totalOrders}</div>
                                <div style="font-size: 0.75rem; color: var(--gray-500);">Total Orders</div>
                            </div>
                        </td>
                        <td>
                            <div style="font-weight: 700; color: var(--success); font-size: 1rem;">
                                ${appState.settings.currency}${customer.totalSpent.toLocaleString()}
                            </div>
                        </td>
                        <td>
                            <span class="badge badge-${statusClass}">${customer.status.toUpperCase()}</span>
                            ${customer.type === 'vip' ? '<span class="badge badge-warning" style="margin-left: 0.25rem;">VIP</span>' : ''}
                            ${customerComplaints.length > 0 ? `<span class="badge badge-danger" style="margin-left: 0.25rem;">${customerComplaints.length} Complaints</span>` : ''}
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="viewCustomer(${customer.id})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="editCustomer(${customer.id})" title="Edit Customer">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-warning hover-glow" onclick="addComplaintForCustomer(${customer.id})" title="Add Complaint">
                                    <i class="fas fa-exclamation"></i>
                                </button>
                                <button class="btn btn-sm btn-danger hover-glow" onclick="deleteCustomer(${customer.id})" title="Delete Customer">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateCustomerStats() {
            const totalCustomers = appState.customers.length;
            const activeOrders = appState.orders.filter(o => ['pending', 'processing', 'shipped'].includes(o.status)).length;
            const openComplaints = appState.complaints.filter(c => c.status !== 'resolved').length;
            const avgSatisfaction = appState.customers.length > 0 ? 
                (appState.customers.reduce((sum, c) => sum + c.satisfaction, 0) / appState.customers.length).toFixed(1) : '5.0';
            
            animateValue('totalCustomers', totalCustomers);
            animateValue('activeOrders', activeOrders);
            animateValue('openComplaints', openComplaints);
            document.getElementById('customerSatisfaction').textContent = avgSatisfaction;
            
            // Update dashboard stats
            if (document.getElementById('totalCustomersDash')) {
                document.getElementById('totalCustomersDash').textContent = totalCustomers;
            }
            
            // Update settings stats
            if (document.getElementById('statsCustomersSettings')) {
                document.getElementById('statsCustomersSettings').textContent = totalCustomers;
            }
            
            // Update badges
            const complaintsCount = document.getElementById('complaintsCount');
            const pendingOrdersCount = document.getElementById('pendingOrdersCount');
            
            if (complaintsCount) {
                if (openComplaints > 0) {
                    complaintsCount.textContent = openComplaints;
                    complaintsCount.classList.remove('hidden');
                } else {
                    complaintsCount.classList.add('hidden');
                }
            }
            
            if (pendingOrdersCount) {
                if (activeOrders > 0) {
                    pendingOrdersCount.textContent = activeOrders;
                    pendingOrdersCount.classList.remove('hidden');
                } else {
                    pendingOrdersCount.classList.add('hidden');
                }
            }
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            // Implementation for customer search
            renderCustomersTable();
        }

        function filterCustomers(filter) {
            appState.customerFilter = filter;
            
            // Update filter chips
            const customerFilters = document.querySelector('#customersContent .customer-filters');
            if (customerFilters) {
                customerFilters.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                event.target.classList.add('active');
            }
            
            renderCustomersTable();
        }

        // Complaint Management Functions
        function showAddComplaintModal() {
            updateComplaintCustomerOptions();
            document.getElementById('addComplaintModal').classList.add('show');
        }

        function closeAddComplaintModal() {
            document.getElementById('addComplaintModal').classList.remove('show');
            document.getElementById('addComplaintForm').reset();
        }

        function updateComplaintCustomerOptions() {
            const select = document.getElementById('complaintCustomer');
            select.innerHTML = '<option value="">Select Customer</option>';
            
            appState.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} (${customer.email})`;
                select.appendChild(option);
            });
        }

        function addComplaint() {
            const customerId = document.getElementById('complaintCustomer').value;
            const type = document.getElementById('complaintType').value;
            const priority = document.getElementById('complaintPriority').value;
            const orderId = document.getElementById('complaintOrderId').value.trim();
            const subject = document.getElementById('complaintSubject').value.trim();
            const description = document.getElementById('complaintDescription').value.trim();
            
            if (!customerId || !type || !subject || !description) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const complaint = {
                id: 'CMP' + Date.now(),
                customerId: parseInt(customerId),
                type,
                priority,
                orderId,
                subject,
                description,
                status: 'pending',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                assignedTo: null,
                resolution: null,
                resolutionDate: null
            };
            
            appState.complaints.push(complaint);
            saveAppState();
            renderComplaints();
            updateCustomerStats();
            closeAddComplaintModal();
            
            showToast(` Complaint ${complaint.id} registered successfully!`, 'success');
        }

        function renderComplaints() {
            const container = document.getElementById('complaintsContainer');
            
            if (appState.complaints.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon animate-float">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="empty-state-title">No complaints registered</div>
                        <div class="empty-state-description">Great! Your customers are happy. New complaints will appear here.</div>
                    </div>
                `;
                return;
            }
            
            let filteredComplaints = appState.complaints;
            
            if (appState.complaintFilter !== 'all') {
                filteredComplaints = appState.complaints.filter(complaint => {
                    switch (appState.complaintFilter) {
                        case 'pending': return complaint.status === 'pending';
                        case 'urgent': return complaint.priority === 'urgent';
                        case 'resolved': return complaint.status === 'resolved';
                        case 'product': return complaint.type === 'product';
                        case 'delivery': return complaint.type === 'delivery';
                        default: return true;
                    }
                });
            }
            
            container.innerHTML = filteredComplaints.map(complaint => {
                const customer = appState.customers.find(c => c.id === complaint.customerId);
                const priorityClass = complaint.priority === 'urgent' ? 'urgent' : complaint.status === 'resolved' ? 'resolved' : '';
                const statusClass = complaint.status === 'resolved' ? 'status-resolved' : complaint.priority === 'urgent' ? 'status-urgent' : 'status-pending';
                
                return `
                    <div class="complaint-card ${priorityClass}">
                        <div class="complaint-header">
                            <div class="complaint-id">${complaint.id}</div>
                            <div class="complaint-status ${statusClass}">${complaint.status}</div>
                        </div>
                        <div style="margin-bottom: var(--spacing);">
                            <div style="font-weight: 700; font-size: 1rem; color: var(--gray-900);">${complaint.subject}</div>
                            <div style="font-size: 0.875rem; color: var(--gray-600); margin-top: 0.25rem;">
                                Customer: ${customer ? customer.name : 'Unknown'} | Type: ${complaint.type} | Priority: ${complaint.priority}
                                ${complaint.orderId ? ` | Order: ${complaint.orderId}` : ''}
                            </div>
                        </div>
                        <div style="font-size: 0.875rem; color: var(--gray-700); line-height: 1.5; margin-bottom: var(--spacing);">
                            ${complaint.description}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing);">
                            <div style="font-size: 0.75rem; color: var(--gray-500);">
                                Created: ${new Date(complaint.createdAt).toLocaleDateString()}
                                ${complaint.resolutionDate ? ` | Resolved: ${new Date(complaint.resolutionDate).toLocaleDateString()}` : ''}
                            </div>
                            <div style="display: flex; gap: var(--spacing-xs);">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="viewComplaint('${complaint.id}')" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${complaint.status !== 'resolved' ? `<button class="btn btn-sm btn-success hover-glow" onclick="resolveComplaint('${complaint.id}')" title="Mark Resolved">
                                    <i class="fas fa-check"></i>
                                </button>` : ''}
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="updateComplaint('${complaint.id}')" title="Update">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterComplaints(filter) {
            appState.complaintFilter = filter;
            
            // Update filter chips
            const complaintFilters = document.querySelector('#complaintsContent .customer-filters');
            if (complaintFilters) {
                complaintFilters.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                event.target.classList.add('active');
            }
            
            renderComplaints();
        }

        function resolveComplaint(complaintId) {
            const complaint = appState.complaints.find(c => c.id === complaintId);
            if (complaint) {
                complaint.status = 'resolved';
                complaint.resolutionDate = new Date().toISOString();
                complaint.updatedAt = new Date().toISOString();
                saveAppState();
                renderComplaints();
                updateCustomerStats();
                showToast(` Complaint ${complaintId} marked as resolved!`, 'success');
            }
        }

        // Order Management Functions
        function renderOrders() {
            const container = document.getElementById('ordersContainer');
            
            if (appState.orders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon animate-float">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="empty-state-title">No orders to track</div>
                        <div class="empty-state-description">Orders will appear here for tracking and management.</div>
                        <button class="btn btn-primary btn-lg hover-glow" onclick="showAddOrderModal()">
                            <i class="fas fa-plus"></i> Create First Order
                        </button>
                    </div>
                `;
                return;
            }
            
            // Implementation for orders rendering would go here
        }

        // Load demo customer data
        function loadDemoCustomerData() {
            if (appState.customers.length === 0) {
                const demoCustomers = [
                    {
                        id: 1001,
                        name: 'Rajesh Kumar',
                        email: 'rajesh@example.com',
                        phone: '+91 98765 43210',
                        type: 'vip',
                        address: '123 MG Road, Bangalore, Karnataka 560001',
                        notes: 'Frequent buyer, prefers electronics',
                        totalOrders: 15,
                        totalSpent: 125000,
                        status: 'active',
                        registrationDate: '2024-01-15T10:00:00.000Z',
                        lastOrderDate: '2025-08-20T14:30:00.000Z',
                        satisfaction: 4.8
                    },
                    {
                        id: 1002,
                        name: 'Priya Sharma',
                        email: 'priya.sharma@example.com',
                        phone: '+91 87654 32109',
                        type: 'regular',
                        address: '456 Park Street, Mumbai, Maharashtra 400001',
                        notes: 'Interested in fashion and lifestyle products',
                        totalOrders: 8,
                        totalSpent: 45000,
                        status: 'active',
                        registrationDate: '2024-03-22T09:15:00.000Z',
                        lastOrderDate: '2025-08-18T11:45:00.000Z',
                        satisfaction: 4.5
                    },
                    {
                        id: 1003,
                        name: 'Amit Singh',
                        email: 'amit.singh@example.com',
                        phone: '+91 76543 21098',
                        type: 'wholesale',
                        address: '789 Industrial Estate, Delhi 110001',
                        notes: 'Bulk buyer for retail chain',
                        totalOrders: 25,
                        totalSpent: 350000,
                        status: 'active',
                        registrationDate: '2023-11-10T16:20:00.000Z',
                        lastOrderDate: '2025-08-22T13:00:00.000Z',
                        satisfaction: 4.9
                    }
                ];
                
                appState.customers = demoCustomers;
                saveAppState();
                showToast('Demo customer data loaded!', 'info', 3000);
            }
        }

        // Enhanced Charts Initialization
        function initializeCharts() {
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js not available');
                return;
            }

            // Configure Chart.js defaults for clean design
            Chart.defaults.font.family = 'Inter, sans-serif';
            Chart.defaults.font.size = 11;
            Chart.defaults.font.weight = '500';
            Chart.defaults.color = '#6b7280';

            // Initialize all charts with delay for smooth loading
            setTimeout(() => {
                initializeSalesChart();
                initializeCategoryChart();
                initializeInventoryChart();
            }, 400);
        }

        // Sales Chart with Clean Design
        function initializeSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;

            if (appState.charts.sales) {
                appState.charts.sales.destroy();
            }

            const salesData = generateSalesData();
            
            appState.charts.sales = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: salesData.labels,
                    datasets: [{
                        label: 'Daily Sales',
                        data: salesData.sales,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.05)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#2563eb',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }, {
                        label: 'Revenue',
                        data: salesData.revenue,
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.05)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#f97316',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 16,
                                font: { weight: '600' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#2563eb',
                            borderWidth: 1,
                            cornerRadius: 6,
                            padding: 10
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { weight: '500' } }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { 
                                color: 'rgba(0, 0, 0, 0.04)',
                                drawBorder: false 
                            },
                            ticks: { 
                                font: { weight: '500' },
                                callback: function(value) {
                                    return appState.settings.currency + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutCubic'
                    }
                }
            });
        }

        // Category Distribution Chart with Clean Design
        function initializeCategoryChart() {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;

            if (appState.charts.category) {
                appState.charts.category.destroy();
            }

            const categoryData = generateCategoryData();
            
            appState.charts.category = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryData.labels,
                    datasets: [{
                        data: categoryData.values,
                        backgroundColor: [
                            '#2563eb', '#f97316', '#10b981', '#f59e0b',
                            '#ef4444', '#06b6d4', '#8b5cf6', '#ec4899'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 12,
                                font: { weight: '500' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            cornerRadius: 6,
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((context.parsed / total) * 100);
                                    return context.label + ': ' + percentage + '%';
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1500,
                        easing: 'easeInOutCubic'
                    }
                }
            });
        }

        // Inventory Levels Chart with Clean Design
        function initializeInventoryChart() {
            const ctx = document.getElementById('inventoryChart');
            if (!ctx) return;

            if (appState.charts.inventory) {
                appState.charts.inventory.destroy();
            }

            const inventoryData = generateInventoryData();
            
            appState.charts.inventory = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: inventoryData.labels,
                    datasets: [{
                        label: 'Stock Levels',
                        data: inventoryData.values,
                        backgroundColor: [
                            '#10b981', '#f59e0b', '#ef4444', '#06b6d4',
                            '#8b5cf6', '#ec4899', '#2563eb', '#f97316'
                        ],
                        borderWidth: 0,
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            cornerRadius: 6,
                            padding: 10
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { weight: '500' } }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { 
                                color: 'rgba(0, 0, 0, 0.04)',
                                drawBorder: false 
                            },
                            ticks: { font: { weight: '500' } }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutCubic'
                    }
                }
            });
        }

        // Generate Sample Data for Charts
        function generateSalesData() {
            const labels = [];
            const sales = [];
            const revenue = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                
                const dailySales = Math.floor(Math.random() * 40000) + 15000;
                const dailyRevenue = dailySales * (Math.random() * 0.2 + 1.1);
                
                sales.push(dailySales);
                revenue.push(Math.floor(dailyRevenue));
            }
            
            return { labels, sales, revenue };
        }

        function generateCategoryData() {
            const categories = appState.stock.reduce((acc, product) => {
                acc[product.category] = (acc[product.category] || 0) + product.quantity;
                return acc;
            }, {});
            
            if (Object.keys(categories).length === 0) {
                return {
                    labels: ['Electronics', 'Clothing', 'Books', 'Food & Beverages'],
                    values: [30, 25, 20, 25]
                };
            }
            
            return {
                labels: Object.keys(categories),
                values: Object.values(categories)
            };
        }

        function generateInventoryData() {
            const categories = {};
            appState.stock.forEach(product => {
                categories[product.category] = (categories[product.category] || 0) + product.quantity;
            });
            
            if (Object.keys(categories).length === 0) {
                return {
                    labels: ['Electronics', 'Clothing', 'Books', 'Food', 'Health', 'Sports', 'Home', 'General'],
                    values: [120, 180, 60, 100, 80, 90, 140, 160]
                };
            }
            
            return {
                labels: Object.keys(categories),
                values: Object.values(categories)
            };
        }

        // Update Charts when data changes
        function updateCharts() {
            setTimeout(() => {
                if (appState.charts.sales) {
                    const salesData = generateSalesData();
                    appState.charts.sales.data.labels = salesData.labels;
                    appState.charts.sales.data.datasets[0].data = salesData.sales;
                    appState.charts.sales.data.datasets[1].data = salesData.revenue;
                    appState.charts.sales.update('active');
                }
                
                if (appState.charts.category) {
                    const categoryData = generateCategoryData();
                    appState.charts.category.data.labels = categoryData.labels;
                    appState.charts.category.data.datasets[0].data = categoryData.values;
                    appState.charts.category.update('active');
                }
                
                if (appState.charts.inventory) {
                    const inventoryData = generateInventoryData();
                    appState.charts.inventory.data.labels = inventoryData.labels;
                    appState.charts.inventory.data.datasets[0].data = inventoryData.values;
                    appState.charts.inventory.update('active');
                }
            }, 200);
        }

        // Enhanced Analytics Functions
        function updateAnalytics() {
            updateAdvancedKPIs();
            setTimeout(updateAdvancedCharts, 400);
        }

        function updateAdvancedKPIs() {
            const totalRevenue = appState.invoices.reduce((sum, inv) => sum + inv.total, 0);
            const totalOrders = appState.invoices.length;
            const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;
            
            // Update KPI values with clean animations
            animateValue('totalRevenue', totalRevenue, appState.settings.currency);
            animateValue('totalOrders', totalOrders);
            animateValue('avgOrderValue', avgOrderValue, appState.settings.currency);
            
            // Update additional KPIs
            setTimeout(() => {
                const monthlyRevenue = appState.invoices
                    .filter(inv => new Date(inv.createdAt).getMonth() === new Date().getMonth())
                    .reduce((sum, inv) => sum + inv.total, 0);
                
                animateValue('monthlyRevenue', monthlyRevenue, appState.settings.currency);
                animateValue('todaySales', Math.floor(Math.random() * 35000) + 15000, appState.settings.currency);
            }, 150);
        }

        function animateValue(elementId, finalValue, prefix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = 0;
            const duration = 1500;
            const startTime = performance.now();
            
            function animate(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                
                const currentValue = startValue + (finalValue - startValue) * easeOutCubic(progress);
                
                if (prefix) {
                    element.textContent = prefix + Math.floor(currentValue).toLocaleString();
                } else {
                    element.textContent = Math.floor(currentValue).toLocaleString();
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            requestAnimationFrame(animate);
        }

        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        function updateAdvancedCharts() {
            initializeAdvancedAnalyticsCharts();
        }

        function initializeAdvancedAnalyticsCharts() {
            initializeRevenueChart();
            initializeProductChart();
            initializeMonthlyChart();
        }

        function initializeRevenueChart() {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;

            if (appState.charts.revenue) {
                appState.charts.revenue.destroy();
            }

            const revenueData = generateAdvancedRevenueData();
            
            appState.charts.revenue = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: revenueData.labels,
                    datasets: [{
                        label: 'Revenue Trend',
                        data: revenueData.values,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.08)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 16,
                                font: { weight: '600' }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { weight: '500' } }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { 
                                color: 'rgba(16, 185, 129, 0.08)',
                                drawBorder: false 
                            },
                            ticks: { 
                                font: { weight: '500' },
                                callback: function(value) {
                                    return appState.settings.currency + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function initializeProductChart() {
            const ctx = document.getElementById('productChart');
            if (!ctx) return;

            if (appState.charts.product) {
                appState.charts.product.destroy();
            }

            const productData = generateProductPerformanceData();
            
            appState.charts.product = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: productData.labels,
                    datasets: [{
                        data: productData.values,
                        backgroundColor: [
                            'rgba(37, 99, 235, 0.6)',
                            'rgba(249, 115, 22, 0.6)',
                            'rgba(16, 185, 129, 0.6)',
                            'rgba(245, 158, 11, 0.6)',
                            'rgba(239, 68, 68, 0.6)'
                        ],
                        borderColor: [
                            '#2563eb', '#f97316', '#10b981', '#f59e0b', '#ef4444'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 12,
                                font: { weight: '500' }
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function initializeMonthlyChart() {
            const ctx = document.getElementById('monthlyChart');
            if (!ctx) return;

            if (appState.charts.monthly) {
                appState.charts.monthly.destroy();
            }

            const monthlyData = generateMonthlyComparisonData();
            
            appState.charts.monthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'This Year',
                        data: monthlyData.thisYear,
                        backgroundColor: 'rgba(37, 99, 235, 0.7)',
                        borderColor: '#2563eb',
                        borderWidth: 0,
                        borderRadius: 6,
                        borderSkipped: false
                    }, {
                        label: 'Last Year',
                        data: monthlyData.lastYear,
                        backgroundColor: 'rgba(249, 115, 22, 0.5)',
                        borderColor: '#f97316',
                        borderWidth: 0,
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 16,
                                font: { weight: '600' }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { weight: '500' } }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { 
                                color: 'rgba(0, 0, 0, 0.04)',
                                drawBorder: false 
                            },
                            ticks: { font: { weight: '500' } }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Generate Advanced Chart Data
        function generateAdvancedRevenueData() {
            const labels = [];
            const values = [];
            
            for (let i = 11; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' }));
                values.push(Math.floor(Math.random() * 80000) + 40000);
            }
            
            return { labels, values };
        }

        function generateProductPerformanceData() {
            const topProducts = appState.stock
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);
            
            if (topProducts.length === 0) {
                return {
                    labels: ['iPhone 15', 'MacBook Air', 'AirPods Pro', 'iPad Air', 'Apple Watch'],
                    values: [75, 60, 55, 50, 45]
                };
            }
            
            return {
                labels: topProducts.map(p => p.name.length > 12 ? p.name.substring(0, 12) + '...' : p.name),
                values: topProducts.map(p => p.quantity)
            };
        }

        function generateMonthlyComparisonData() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const thisYear = months.map(() => Math.floor(Math.random() * 70000) + 20000);
            const lastYear = months.map(() => Math.floor(Math.random() * 60000) + 15000);
            
            return {
                labels: months,
                thisYear,
                lastYear
            };
        }

        // Enhanced Demo Data Loading
        function loadEnhancedDemoData() {
            if (appState.stock.length === 0) {
                showToast(' Loading enhanced demo data with analytics...', 'info', 3000);
                
                const demoProducts = [
                    { name: 'iPhone 15 Pro Max 1TB', price: 159900, quantity: 25, category: 'Electronics', description: 'Latest flagship smartphone with titanium design and A17 Pro chip' },
                    { name: 'Samsung Galaxy S24 Ultra 512GB', price: 124900, quantity: 30, category: 'Electronics', description: 'Premium Android flagship with S Pen and advanced AI features' },
                    { name: 'MacBook Air M3 15-inch', price: 134900, quantity: 15, category: 'Electronics', description: 'Ultra-thin laptop powered by Apple M3 with 18-hour battery life' },
                    { name: 'Nike Air Jordan 1 Retro High', price: 14995, quantity: 45, category: 'Sports & Outdoors', description: 'Iconic basketball sneakers with premium leather construction' },
                    { name: 'Levi\'s 501 Original Fit Jeans', price: 5999, quantity: 60, category: 'Clothing', description: 'Classic straight-fit jeans with authentic vintage styling' },
                    { name: 'Dell UltraSharp U2723QE 27" 4K', price: 52999, quantity: 18, category: 'Electronics', description: 'Professional 4K monitor with USB-C connectivity' },
                    { name: 'Herman Miller Aeron Chair Size B', price: 89999, quantity: 8, category: 'Home & Garden', description: 'Ergonomic office chair with advanced PostureFit technology' },
                    { name: 'Sony WH-1000XM5 Headphones', price: 29990, quantity: 35, category: 'Electronics', description: 'Industry-leading noise canceling with 30-hour battery life' },
                    { name: 'Artisanal Ceramic Coffee Mug Set', price: 1299, quantity: 3, category: 'General', description: 'Handcrafted ceramic mugs with unique glazed finish (Set of 4)' },
                    { name: 'Moleskine Classic Notebook Bundle', price: 2999, quantity: 75, category: 'Books & Stationery', description: 'Premium hardcover notebooks with dotted pages (Pack of 3)' },
                    { name: 'Organic Green Tea Premium Blend', price: 899, quantity: 5, category: 'Food & Beverages', description: 'Handpicked organic green tea with antioxidants (100g)' },
                    { name: 'L\'Oreal Paris Revitalift Serum', price: 1799, quantity: 40, category: 'Health & Beauty', description: 'Anti-aging serum with hyaluronic acid and vitamin C' },
                    { name: 'Adidas Ultraboost 23 Running Shoes', price: 16999, quantity: 28, category: 'Sports & Outdoors', description: 'High-performance running shoes with Boost cushioning technology' },
                    { name: 'IKEA HEMNES Bookcase White', price: 8999, quantity: 12, category: 'Home & Garden', description: 'Adjustable shelves bookcase with solid wood construction' },
                    { name: 'JavaScript: The Complete Guide', price: 3499, quantity: 22, category: 'Books & Stationery', description: 'Comprehensive guide to modern JavaScript development' }
                ];

                demoProducts.forEach((product, index) => {
                    setTimeout(() => {
                        appState.stock.push({
                            id: Date.now() + Math.random(),
                            ...product,
                            sku: generateSKU(),
                            dateAdded: new Date().toISOString(),
                            lastUpdated: new Date().toISOString()
                        });
                        
                        if (index === demoProducts.length - 1) {
                            saveAppState();
                            updateDashboard();
                            renderStockTable();
                            updateCharts();
                            showToast(' Enhanced demo data loaded! Explore advanced analytics features.', 'success', 4000);
                        }
                    }, index * 120);
                });
            }
        }

        // Enhanced Stock Management
        document.getElementById('addProductForm').addEventListener('submit', function(event) {
            event.preventDefault();
            addProduct();
        });

        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const category = document.getElementById('productCategory').value;
            const description = document.getElementById('productDescription').value.trim();
            
            clearFormErrors();
            
            if (!name) {
                showFieldError('productName', ' Product name is required');
                return;
            }
            
            if (!price || price <= 0) {
                showFieldError('productPrice', ' Valid price is required');
                return;
            }
            
            if (isNaN(quantity) || quantity < 0) {
                showFieldError('productQuantity', ' Valid quantity is required');
                return;
            }
            
            const existingIndex = appState.stock.findIndex(p => 
                p.name.toLowerCase() === name.toLowerCase()
            );
            
            if (existingIndex >= 0) {
                appState.stock[existingIndex].quantity += quantity;
                appState.stock[existingIndex].price = price;
                appState.stock[existingIndex].category = category;
                appState.stock[existingIndex].description = description;
                appState.stock[existingIndex].lastUpdated = new Date().toISOString();
                showToast(` Updated ${name} - Added ${quantity} units with enhanced tracking`, 'success');
            } else {
                const product = {
                    id: Date.now() + Math.random(),
                    name,
                    price,
                    quantity,
                    category,
                    description,
                    sku: generateSKU(),
                    dateAdded: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                appState.stock.push(product);
                showToast(` Added ${name} to inventory with advanced analytics tracking!`, 'success');
            }
            
            clearProductForm();
            renderStockTable();
            updateDashboard();
            updateCharts();
            checkLowStock();
            saveAppState();
            
            setTimeout(() => document.getElementById('productName').focus(), 300);
        }

        function clearProductForm() {
            const form = document.getElementById('addProductForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            
            inputs.forEach((input, index) => {
                setTimeout(() => {
                    input.style.transform = 'scale(0.98)';
                    if (input.id !== 'productSKU' && input.id !== 'productCategory') {
                        input.value = '';
                    }
                    if (input.id === 'productCategory') {
                        input.selectedIndex = 0;
                    }
                    setTimeout(() => {
                        input.style.transform = 'scale(1)';
                    }, 100);
                }, index * 50);
            });
            
            generateSKU();
        }

        function generateSKU() {
            const timestamp = Date.now().toString().slice(-6);
            const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            const sku = `KMP${timestamp}${randomNum}`;
            const skuField = document.getElementById('productSKU');
            if (skuField) {
                skuField.value = sku;
            }
            return sku;
        }

        // Enhanced Dashboard Updates
        function updateDashboard() {
            const stats = [
                { id: 'totalProducts', value: appState.stock.length },
                { id: 'cartItems', value: appState.cart.length },
                { 
                    id: 'totalValue', 
                    value: `${appState.settings.currency}${appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toLocaleString()}` 
                },
                { id: 'lowStockItems', value: appState.stock.filter(p => p.quantity < appState.settings.lowStockThreshold).length }
            ];
            
            stats.forEach((stat, index) => {
                setTimeout(() => {
                    const element = document.getElementById(stat.id);
                    if (element) {
                        element.style.transform = 'scale(1.05)';
                        element.textContent = stat.value;
                        setTimeout(() => {
                            element.style.transform = 'scale(1)';
                        }, 200);
                    }
                }, index * 80);
            });
            
            updateCustomerStats();
            updateNavigationBadges();
        }

        function updateNavigationBadges() {
            const cartBadge = document.getElementById('cartBadge');
            const lowStockBadge = document.getElementById('lowStockBadge');
            
            if (cartBadge) {
                if (appState.cart.length > 0) {
                    cartBadge.textContent = appState.cart.length;
                    cartBadge.classList.remove('hidden');
                } else {
                    cartBadge.classList.add('hidden');
                }
            }
            
            if (lowStockBadge) {
                const lowStockCount = appState.stock.filter(p => p.quantity < appState.settings.lowStockThreshold).length;
                if (lowStockCount > 0) {
                    lowStockBadge.textContent = lowStockCount;
                    lowStockBadge.classList.remove('hidden');
                } else {
                    lowStockBadge.classList.add('hidden');
                }
            }
        }

        // Enhanced Smart Cart Functions
        function searchProducts() {
            const searchTerm = document.getElementById('cartSearch').value.toLowerCase();
            const suggestions = document.getElementById('productSuggestions');
            
            if (searchTerm.length < 2) {
                suggestions.classList.add('hidden');
                return;
            }
            
            const matches = appState.stock.filter(product =>
                product.name.toLowerCase().includes(searchTerm) && 
                product.quantity > 0
            ).slice(0, 6);
            
            if (matches.length > 0) {
                suggestions.innerHTML = matches.map((product, index) => {
                    const categoryEmoji = getCategoryEmoji(product.category);
                    const stockLevel = getStockLevel(product.quantity);
                    const stockIndicator = stockLevel === 'low' ? '' : stockLevel === 'high' ? '' : '';
                    
                    return `
                        <div onclick="addToCartById(${product.id})" 
                             class="suggestion-item hover-lift" 
                             data-index="${index}"
                             style="padding: var(--spacing); border-radius: var(--radius-lg); margin: 0.25rem; background: linear-gradient(135deg, var(--white), var(--gray-50)); border: 1px solid var(--gray-100);">
                            <div style="display: flex; align-items: center; gap: var(--spacing);">
                                <div style="width: 32px; height: 32px; background: var(--gradient-primary); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 1rem; box-shadow: var(--shadow-sm);">
                                    ${categoryEmoji}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--gray-900); font-size: 0.875rem;">${product.name}</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-600); display: flex; align-items: center; gap: var(--spacing-xs); margin-top: 0.125rem;">
                                        <span style="color: var(--success); font-weight: 600;">${appState.settings.currency}${product.price.toLocaleString()}</span>
                                        <span></span>
                                        <span>${stockIndicator} ${product.quantity} in stock</span>
                                        <span class="badge badge-secondary" style="font-size: 0.625rem;">${product.category}</span>
                                    </div>
                                    ${product.description ? `<div style="font-size: 0.6875rem; color: var(--gray-500); margin-top: 0.125rem; font-style: italic;">${product.description.substring(0, 50)}...</div>` : ''}
                                </div>
                                <i class="fas fa-plus-circle" style="color: var(--primary); font-size: 1.25rem;"></i>
                            </div>
                        </div>
                    `;
                }).join('');
                suggestions.classList.remove('hidden');
                appState.productSuggestions = matches;
            } else {
                suggestions.innerHTML = `
                    <div style="padding: var(--spacing-xl); text-align: center; color: var(--gray-500);">
                        <i class="fas fa-search animate-pulse" style="font-size: 2.5rem; margin-bottom: var(--spacing); opacity: 0.4;"></i>
                        <div style="font-weight: 600; font-size: 1rem;">No products found matching "${searchTerm}"</div>
                        <div style="font-size: 0.8125rem; margin-top: 0.25rem;">Try a different search term or browse categories</div>
                    </div>
                `;
                suggestions.classList.remove('hidden');
                appState.productSuggestions = [];
            }
        }

        function getCategoryEmoji(category) {
            const emojis = {
                'General': '',
                'Electronics': '',
                'Clothing': '',
                'Food & Beverages': '',
                'Books & Stationery': '',
                'Health & Beauty': '',
                'Sports & Outdoors': '',
                'Home & Garden': ''
            };
            return emojis[category] || '';
        }

        function getStockLevel(quantity) {
            if (quantity === 0) return 'out';
            if (quantity < appState.settings.lowStockThreshold) return 'low';
            if (quantity <= 50) return 'medium';
            return 'high';
        }

        function getStockBadge(level) {
            const badges = {
                out: '<span class="badge badge-danger animate-pulse"> Out of Stock</span>',
                low: '<span class="badge badge-warning"> Low Stock</span>',
                medium: '<span class="badge badge-secondary"> In Stock</span>',
                high: '<span class="badge badge-success"> High Stock</span>'
            };
            return badges[level];
        }

        // Enhanced Stock Table Rendering
        function renderStockTable() {
            const tbody = document.getElementById('stockTableBody');
            
            if (appState.stock.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-state-icon animate-float"><i class="fas fa-box-open"></i></div>
                                <div class="empty-state-title">No products in inventory</div>
                                <div class="empty-state-description">Start building your inventory with our advanced product management system.</div>
                                <button class="btn btn-primary btn-lg hover-glow" onclick="document.getElementById('productName').focus()">
                                    <i class="fas fa-plus-circle"></i> Add Your First Product
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = appState.stock.map((product, index) => {
                const stockLevel = getStockLevel(product.quantity);
                const stockBadge = getStockBadge(stockLevel);
                const categoryEmoji = getCategoryEmoji(product.category);
                const totalValue = product.price * product.quantity;
                
                return `
                    <tr class="hover-lift" style="animation-delay: ${index * 0.03}s;">
                        <td>
                            <div style="display: flex; align-items: center; gap: var(--spacing);">
                                <div style="width: 40px; height: 40px; background: var(--gradient-primary); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 1.25rem; box-shadow: var(--shadow-sm);">
                                    ${categoryEmoji}
                                </div>
                                <div>
                                    <div style="font-weight: 700; color: var(--gray-900); font-size: 0.875rem;">${product.name}</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem;">
                                        SKU: ${product.sku} | Added: ${new Date(product.dateAdded).toLocaleDateString()}
                                    </div>
                                    ${product.description ? `<div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem; font-style: italic;">${product.description.substring(0, 60)}...</div>` : ''}
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="badge badge-secondary">${product.category}</span>
                        </td>
                        <td>
                            <div style="font-weight: 700; color: var(--success); font-size: 1rem;">
                                ${appState.settings.currency}${product.price.toLocaleString()}
                            </div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">
                                Total: ${appState.settings.currency}${totalValue.toLocaleString()}
                            </div>
                        </td>
                        <td>
                            <div style="text-align: center;">
                                <div style="font-weight: 700; font-size: 1.25rem; color: ${stockLevel === 'low' ? 'var(--warning)' : stockLevel === 'out' ? 'var(--error)' : 'var(--primary)'};">
                                    ${product.quantity}
                                </div>
                                <div style="font-size: 0.6875rem; color: var(--gray-500);">units</div>
                            </div>
                        </td>
                        <td>${stockBadge}</td>
                        <td>
                            <code style="background: var(--gray-100); padding: 0.25rem 0.5rem; border-radius: var(--radius); font-size: 0.75rem; color: var(--gray-700);">
                                ${product.sku}
                            </code>
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-primary hover-glow" onclick="addToCartById(${product.id})" title="Add to Cart">
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                                <button class="btn btn-sm btn-secondary hover-glow" onclick="editProduct(${product.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-warning hover-glow" onclick="adjustStock(${product.id})" title="Adjust Stock">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn btn-sm btn-danger hover-glow" onclick="deleteProduct(${product.id})" title="Delete">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Enhanced Cart Functions
        function handleSearchKeydown(event) {
            const suggestions = document.getElementById('productSuggestions');
            const isVisible = !suggestions.classList.contains('hidden');
            
            if (!isVisible || appState.productSuggestions.length === 0) return;
            
            switch (event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    appState.searchIndex = Math.min(appState.searchIndex + 1, appState.productSuggestions.length - 1);
                    updateSuggestionSelection();
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    appState.searchIndex = Math.max(appState.searchIndex - 1, 0);
                    updateSuggestionSelection();
                    break;
                case 'Enter':
                    event.preventDefault();
                    if (appState.productSuggestions[appState.searchIndex]) {
                        addToCartById(appState.productSuggestions[appState.searchIndex].id);
                    }
                    break;
                case 'Escape':
                    suggestions.classList.add('hidden');
                    document.getElementById('cartSearch').blur();
                    break;
            }
        }

        function updateSuggestionSelection() {
            const suggestionItems = document.querySelectorAll('.suggestion-item');
            suggestionItems.forEach((item, index) => {
                if (index === appState.searchIndex) {
                    item.style.background = 'linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(249, 115, 22, 0.05))';
                    item.style.borderColor = 'var(--primary)';
                } else {
                    item.style.background = 'linear-gradient(135deg, var(--white), var(--gray-50))';
                    item.style.borderColor = 'var(--gray-100)';
                }
            });
        }

        function addToCartById(productId) {
            const product = appState.stock.find(p => p.id === productId);
            if (!product) {
                showToast(' Product not found', 'error');
                return;
            }
            
            if (product.quantity === 0) {
                showToast(' Product out of stock', 'error');
                return;
            }
            
            const existingIndex = appState.cart.findIndex(item => item.id === productId);
            
            if (existingIndex >= 0) {
                if (appState.cart[existingIndex].quantity < product.quantity) {
                    appState.cart[existingIndex].quantity += 1;
                    showToast(` Added another ${product.name} to cart`, 'success');
                } else {
                    showToast(` Cannot add more - only ${product.quantity} in stock`, 'warning');
                    return;
                }
            } else {
                appState.cart.push({
                    ...product,
                    quantity: 1,
                    addedAt: new Date().toISOString()
                });
                showToast(` Added ${product.name} to cart`, 'success');
            }
            
            // Clear search and hide suggestions
            document.getElementById('cartSearch').value = '';
            document.getElementById('productSuggestions').classList.add('hidden');
            appState.searchIndex = 0;
            
            renderCartTable();
            updateCartSummary();
            updateDashboard();
            saveAppState();
        }

        function renderCartTable() {
            const tbody = document.getElementById('cartTableBody');
            const cartSummary = document.getElementById('cartSummary');
            
            if (appState.cart.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5">
                            <div class="empty-state">
                                <div class="empty-state-icon animate-float"><i class="fas fa-shopping-cart"></i></div>
                                <div class="empty-state-title">Your smart cart is empty</div>
                                <div class="empty-state-description">Use the AI-powered search above to find and add products.</div>
                                <button class="btn btn-primary btn-lg hover-glow" onclick="document.getElementById('cartSearch').focus()">
                                    <i class="fas fa-search"></i> Start Smart Shopping
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                cartSummary.style.display = 'none';
                return;
            }
            
            tbody.innerHTML = appState.cart.map((item, index) => {
                const total = item.price * item.quantity;
                const categoryEmoji = getCategoryEmoji(item.category);
                
                return `
                    <tr class="hover-lift" style="animation-delay: ${index * 0.05}s;">
                        <td>
                            <div style="display: flex; align-items: center; gap: var(--spacing);">
                                <div style="width: 32px; height: 32px; background: var(--gradient-primary); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 1rem;">
                                    ${categoryEmoji}
                                </div>
                                <div>
                                    <div style="font-weight: 700; color: var(--gray-900); font-size: 0.875rem;">${item.name}</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-500);">${item.category}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-weight: 700; color: var(--success);">
                                ${appState.settings.currency}${item.price.toLocaleString()}
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                <button class="btn btn-sm btn-secondary" onclick="updateCartQuantity(${item.id}, ${item.quantity - 1})">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" value="${item.quantity}" min="1" max="${item.quantity + appState.stock.find(p => p.id === item.id)?.quantity || 0}" 
                                       onchange="updateCartQuantity(${item.id}, parseInt(this.value))"
                                       style="width: 60px; text-align: center; border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 0.25rem;">
                                <button class="btn btn-sm btn-secondary" onclick="updateCartQuantity(${item.id}, ${item.quantity + 1})">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </td>
                        <td>
                            <div style="font-weight: 700; color: var(--primary); font-size: 1rem;">
                                ${appState.settings.currency}${total.toLocaleString()}
                            </div>
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-danger hover-glow" onclick="removeFromCart(${item.id})" title="Remove">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            cartSummary.style.display = 'block';
        }

        function updateCartQuantity(productId, newQuantity) {
            const cartIndex = appState.cart.findIndex(item => item.id === productId);
            const product = appState.stock.find(p => p.id === productId);
            
            if (cartIndex === -1 || !product) return;
            
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            if (newQuantity > product.quantity) {
                showToast(` Only ${product.quantity} units available`, 'warning');
                return;
            }
            
            appState.cart[cartIndex].quantity = newQuantity;
            renderCartTable();
            updateCartSummary();
            updateDashboard();
            saveAppState();
        }

        function removeFromCart(productId) {
            const itemIndex = appState.cart.findIndex(item => item.id === productId);
            if (itemIndex >= 0) {
                const itemName = appState.cart[itemIndex].name;
                appState.cart.splice(itemIndex, 1);
                renderCartTable();
                updateCartSummary();
                updateDashboard();
                saveAppState();
                showToast(` Removed ${itemName} from cart`, 'info');
            }
        }

        function updateCartSummary() {
            const subtotal = appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * (appState.settings.taxRate / 100);
            const total = subtotal + tax;
            
            document.getElementById('cartSubtotal').textContent = appState.settings.currency + subtotal.toLocaleString();
            document.getElementById('cartTax').textContent = appState.settings.currency + tax.toLocaleString();
            document.getElementById('cartTotal').textContent = appState.settings.currency + total.toLocaleString();
        }

        function clearCart() {
            if (appState.cart.length === 0) {
                showToast('Cart is already empty', 'info');
                return;
            }
            
            showModal(
                ' Clear Cart',
                'Are you sure you want to clear all items from the cart?',
                'btn-danger',
                () => {
                    appState.cart = [];
                    renderCartTable();
                    updateCartSummary();
                    updateDashboard();
                    saveAppState();
                    showToast(' Cart cleared successfully', 'success');
                }
            );
        }

        function proceedToCheckout() {
            if (appState.cart.length === 0) {
                showToast(' Cart is empty', 'error');
                return;
            }
            
            showToast(' Redirecting to invoice generator...', 'info');
            setTimeout(() => {
                showPage('invoice');
                updateInvoicePreview();
            }, 1000);
        }
function printInvoice() {
    const invoice = document.getElementById('invoicePreview');
    if (!invoice) {
        alert('Invoice preview not found');
        return;
    }

    const printContent = `
    <html>
    <head>
        <title>Print Receipt</title>
        <style>
            @page {
                size: 80mm auto;
                margin: 5mm 5mm 10mm 5mm;
            }
            body {
                font-family: 'Courier New', Courier, monospace;
                font-size: 11px;
                margin: 0;
                padding: 0;
                width: 80mm;
                background: #fff;
                color: #000;
                line-height: 1.2;
            }
            .header, .footer {
                text-align: center;
                margin-bottom: 5px;
                padding: 0;
                font-weight: bold;
                font-size: 13px;
            }
            .sub-header {
                text-align: center;
                font-size: 9px;
                margin-bottom: 10px;
                font-weight: normal;
                color: #555;
            }
            .separator {
                border-top: 1px dashed #000;
                margin: 5px 0;
            }
            .invoice-info {
                margin: 0 0 8px 0;
                font-size: 10px;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 10px;
            }
            th, td {
                padding: 3px 5px;
                text-align: left;
            }
            th {
                border-bottom: 1px solid #000;
                font-weight: bold;
            }
            td.right {
                text-align: right;
            }
            .totals {
                margin-top: 8px;
                font-size: 11px;
            }
            .totals div {
                display: flex;
                justify-content: space-between;
                margin: 3px 0;
                font-weight: bold;
            }
            .notes {
                margin-top: 10px;
                font-size: 9px;
                text-align: center;
                color: #333;
                white-space: pre-wrap;
            }
            .thank-you {
                margin-top: 15px;
                font-size: 11px;
                font-weight: bold;
                text-align: center;
            }

            @media print {
                body {
                    width: auto;
                    margin: 0;
                    padding: 0;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">KINGS MART PROFESSIONAL</div>
        <div class="sub-header">Advanced Analytics & Customer Management</div>

        <div class="invoice-info">
            Invoice No: ${document.getElementById('invoiceNumber').value}<br>
            Date: ${new Date(document.getElementById('invoiceDate').value).toLocaleDateString()}
        </div>

        <div class="invoice-info">
            <strong>Bill To:</strong><br>
            ${document.getElementById('customerName').value || 'N/A'}<br>
            ${document.getElementById('customerPhone').value || ''}<br>
            ${document.getElementById('customerEmail').value || ''}<br>
            ${document.getElementById('customerAddress').value || ''}
        </div>

        <div class="separator"></div>

        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th style="width: 30px; text-align:center;">Qty</th>
                    <th style="width: 50px; text-align:right;">Price</th>
                    <th style="width: 50px; text-align:right;">Total</th>
                </tr>
            </thead>
            <tbody>
            ${document.querySelector('#invoiceItems table tbody')?.innerHTML || 
              (function(){
                  let rows = '';
                  const items = JSON.parse(JSON.stringify(appState.cart));
                  items.forEach(item => {
                      let n = item.name.length > 20 ? item.name.substring(0,20)+'...' : item.name;
                      let qty = item.quantity;
                      let price = item.price.toFixed(2);
                      let total = (item.price*item.quantity).toFixed(2);
                      rows += `<tr><td>${n}</td><td style="text-align:center;">${qty}</td><td style="text-align:right;">${price}</td><td style="text-align:right;">${total}</td></tr>`;
                  });
                  return rows || `<tr><td colspan="4" style="text-align:center;">No Items</td></tr>`;
              })()
            }
            </tbody>
        </table>

        <div class="totals">
            <div><span>Subtotal:</span><span>${(appState.cart.reduce((a,b)=>a+(b.price*b.quantity),0)).toFixed(2)}</span></div>
            <div><span>GST (${appState.settings.taxRate}%):</span><span>${(appState.cart.reduce((a,b)=>a+(b.price*b.quantity),0)*appState.settings.taxRate/100).toFixed(2)}</span></div>
            <div><span>Total:</span><span>${(appState.cart.reduce((a,b)=>a+(b.price*b.quantity),0)*(1+appState.settings.taxRate/100)).toFixed(2)}</span></div>
        </div>

        <div class="notes">${document.getElementById('invoiceNotes').value || 'Thank you for your business!'}</div>

        <div class="thank-you">Thank you for shopping with us!</div>

        <div class="footer">
            Powered by Kings Mart Professional
        </div>
    </body>
    </html>`;

    const printWindow = window.open('', '_blank','width=320,height=600');
    if (!printWindow) {
        alert('Please enable popups to print');
        return;
    }

    printWindow.document.open();
    printWindow.document.write(printContent);
    printWindow.document.close();

    printWindow.focus();
    printWindow.onload = function() {
        printWindow.print();
        printWindow.close();
    };
}
// Add a product to cart by id
function addToCart(productId) {
  const product = appState.stock.find(p => p.id === productId);
  if (!product) {
    showToast('Product not found', 'error');
    return;
  }
  if (product.quantity <= 0) {
    showToast('Product out of stock', 'error');
    return;
  }

  const cartIndex = appState.cart.findIndex(item => item.id === productId);
  if (cartIndex >= 0) {
    if (appState.cart[cartIndex].quantity < product.quantity) {
      appState.cart[cartIndex].quantity++;
      showToast(`Increased quantity of ${product.name} in cart`, 'success');
    } else {
      showToast('No more stock available to add', 'warning');
    }
  } else {
    appState.cart.push({...product, quantity: 1});
    showToast(`Added ${product.name} to cart`, 'success');
  }
  saveAppState();
  renderCartTable();
  updateCartSummary();
  updateDashboard();
}

// Opens the product edit form populated for editing
function editProduct(productId) {
  const product = appState.stock.find(p => p.id === productId);
  if (!product) {
    showToast('Product not found', 'error');
    return;
  }
  // populate form fields
  document.getElementById('productName').value = product.name;
  document.getElementById('productPrice').value = product.price;
  document.getElementById('productQuantity').value = product.quantity;
  document.getElementById('productCategory').value = product.category;
  document.getElementById('productSKU').value = product.sku;
  document.getElementById('productDescription').value = product.description;

  // optionally set a hidden current editing id in appState or form
  appState.editingProductId = productId;

  showToast(`Editing product: ${product.name}`, 'info');
  // focus on form for editing
  document.getElementById('productName').focus();
}

// Adjust stock quantity (increment or decrement with prompt)
function adjustStock(productId) {
  const product = appState.stock.find(p => p.id === productId);
  if (!product) {
    showToast('Product not found', 'error');
    return;
  }
  let newQty = prompt(`Adjust stock for ${product.name} (current quantity: ${product.quantity}):`, product.quantity);
  if (newQty === null) return; // cancelled
  newQty = parseInt(newQty);
  if (isNaN(newQty) || newQty < 0) {
    showToast('Invalid quantity entered', 'error');
    return;
  }
  product.quantity = newQty;
  product.lastUpdated = new Date().toISOString();
  saveAppState();
  renderStockTable();
  updateDashboard();
  showToast(`Updated stock for ${product.name} to ${newQty}`, 'success');
}

// Delete product with confirmation
function deleteProduct(productId) {
  const product = appState.stock.find(p => p.id === productId);
  if (!product) {
    showToast('Product not found', 'error');
    return;
  }
  if (!confirm(`Are you sure you want to delete product: ${product.name}? This action cannot be undone.`)) return;

  appState.stock = appState.stock.filter(p => p.id !== productId);
  saveAppState();
  renderStockTable();
  updateDashboard();
  showToast(`Deleted product: ${product.name}`, 'success');
}

// Modify your stock table buttons onclick handlers accordingly:
// For example, replace onclick="addToCartById(${product.id})" with onclick="addToCart(${product.id})" etc.

        // Enhanced Invoice Functions
        function initializeInvoiceForm() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            document.getElementById('invoiceNotes').value = 'Thank you for choosing Kings Mart Professional!';
            generateInvoiceNumber();
        }

        function generateInvoiceNumber() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const sequence = (appState.invoices.length + 1).toString().padStart(4, '0');
            const invoiceNumber = `INV${year}${month}${sequence}`;
            document.getElementById('invoiceNumber').value = invoiceNumber;
            document.getElementById('previewInvoiceNumber').textContent = invoiceNumber;
            return invoiceNumber;
        }

        function updateInvoicePreview() {
            const customerName = document.getElementById('customerName').value || 'Customer Name';
            const customerPhone = document.getElementById('customerPhone').value || 'Not provided';
            const customerEmail = document.getElementById('customerEmail').value || 'Not provided';
            const customerAddress = document.getElementById('customerAddress').value || 'Not provided';
            const invoiceDate = document.getElementById('invoiceDate').value || 'Today';
            const notes = document.getElementById('invoiceNotes').value || 'Thank you for your business!';
            
            // Update customer details
            document.getElementById('previewCustomerDetails').innerHTML = `
                <div><strong>${customerName}</strong></div>
                <div> Phone: ${customerPhone}</div>
                <div> Email: ${customerEmail}</div>
                <div> Address: ${customerAddress}</div>
            `;
            
            document.getElementById('previewDate').textContent = new Date(invoiceDate).toLocaleDateString();
            document.getElementById('previewNotes').textContent = notes;
            
            // Update invoice items
            const itemsBody = document.getElementById('invoiceItemsBody');
            if (appState.cart.length === 0) {
                itemsBody.innerHTML = `
                    <tr>
                        <td colspan="4">
                            <div class="empty-state">
                                <div class="empty-state-icon animate-float"><i class="fas fa-clipboard-list"></i></div>
                                <div class="empty-state-title">No items in cart</div>
                                <div class="empty-state-description">Add items to cart to generate invoice.</div>
                                <button class="btn btn-primary hover-glow" onclick="showPage('cart')">
                                    <i class="fas fa-shopping-cart"></i> Go to Smart Cart
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                document.getElementById('generateBtn').disabled = true;
            } else {
                itemsBody.innerHTML = appState.cart.map(item => `
                    <tr>
                        <td style="text-align: left;">${item.name}</td>
                        <td style="text-align: center;">${item.quantity}</td>
                        <td style="text-align: right;">${appState.settings.currency}${item.price.toLocaleString()}</td>
                        <td style="text-align: right;">${appState.settings.currency}${(item.price * item.quantity).toLocaleString()}</td>
                    </tr>
                `).join('');
                document.getElementById('generateBtn').disabled = false;
            }
            
            // Update totals
            const subtotal = appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * (appState.settings.taxRate / 100);
            const total = subtotal + tax;
            
            document.getElementById('previewSubtotal').textContent = appState.settings.currency + subtotal.toLocaleString();
            document.getElementById('previewTax').textContent = appState.settings.currency + tax.toLocaleString();
            document.getElementById('previewTotal').textContent = appState.settings.currency + total.toLocaleString();
        }

        function generateInvoice() {
            if (appState.cart.length === 0) {
                showToast(' Cannot generate invoice with empty cart', 'error');
                return;
            }
            
            const customerName = document.getElementById('customerName').value.trim();
            if (!customerName) {
                showToast(' Customer name is required', 'error');
                document.getElementById('customerName').focus();
                return;
            }
            
            const invoice = {
                id: document.getElementById('invoiceNumber').value,
                customer: {
                    name: customerName,
                    phone: document.getElementById('customerPhone').value.trim(),
                    email: document.getElementById('customerEmail').value.trim(),
                    address: document.getElementById('customerAddress').value.trim()
                },
                items: [...appState.cart],
                subtotal: appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                tax: appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * (appState.settings.taxRate / 100),
                total: 0,
                paymentMethod: document.getElementById('paymentMethod').value,
                notes: document.getElementById('invoiceNotes').value.trim(),
                createdAt: new Date().toISOString(),
                status: 'paid'
            };
            
            invoice.total = invoice.subtotal + invoice.tax;
            
            // Update stock quantities
            appState.cart.forEach(cartItem => {
                const stockIndex = appState.stock.findIndex(p => p.id === cartItem.id);
                if (stockIndex >= 0) {
                    appState.stock[stockIndex].quantity -= cartItem.quantity;
                }
            });
            
            appState.invoices.push(invoice);
            appState.cart = [];
            saveAppState();
            
            // Generate PDF
            generatePDF(invoice);
            
            // Show success and redirect
            showToast(' Invoice generated successfully! PDF download started.', 'success', 5000);
            
            setTimeout(() => {
                showPage('invoices');
                renderInvoicesTable();
                updateDashboard();
            }, 2000);
        }

        function generatePDF(invoice) {
            if (typeof jsPDF === 'undefined') {
                showToast('PDF generation not available', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // PDF Header
            pdf.setFontSize(20);
            pdf.setTextColor(37, 99, 235);
            pdf.text('KINGS MART PROFESSIONAL', 20, 30);
            
            pdf.setFontSize(10);
            pdf.setTextColor(100, 100, 100);
            pdf.text('Advanced Analytics & Customer Management System', 20, 38);
            
            // Invoice Details
            pdf.setFontSize(14);
            pdf.setTextColor(0, 0, 0);
            pdf.text(`Invoice: ${invoice.id}`, 20, 55);
            pdf.text(`Date: ${new Date(invoice.createdAt).toLocaleDateString()}`, 120, 55);
            
            // Customer Details
            pdf.setFontSize(12);
            pdf.text('Bill To:', 20, 75);
            pdf.text(invoice.customer.name, 20, 85);
            if (invoice.customer.phone) pdf.text(`Phone: ${invoice.customer.phone}`, 20, 95);
            if (invoice.customer.email) pdf.text(`Email: ${invoice.customer.email}`, 20, 105);
            if (invoice.customer.address) pdf.text(`Address: ${invoice.customer.address}`, 20, 115);
            
            // Items Table
            let y = 140;
            pdf.setFontSize(10);
            pdf.text('Item', 20, y);
            pdf.text('Qty', 100, y);
            pdf.text('Price', 130, y);
            pdf.text('Total', 160, y);
            
            y += 10;
            pdf.line(20, y - 5, 190, y - 5);
            
            invoice.items.forEach(item => {
                pdf.text(item.name.substring(0, 30), 20, y);
                pdf.text(item.quantity.toString(), 100, y);
                pdf.text(`${appState.settings.currency}${item.price.toLocaleString()}`, 130, y);
                pdf.text(`${appState.settings.currency}${(item.price * item.quantity).toLocaleString()}`, 160, y);
                y += 10;
            });
            
            // Totals
            y += 10;
            pdf.line(100, y - 5, 190, y - 5);
            pdf.text('Subtotal:', 130, y);
            pdf.text(`${appState.settings.currency}${invoice.subtotal.toLocaleString()}`, 160, y);
            
            y += 10;
            pdf.text(`Tax (${appState.settings.taxRate}%):`, 130, y);
            pdf.text(`${appState.settings.currency}${invoice.tax.toLocaleString()}`, 160, y);
            
            y += 10;
            pdf.setFontSize(12);
            pdf.text('Total:', 130, y);
            pdf.text(`${appState.settings.currency}${invoice.total.toLocaleString()}`, 160, y);
            
            // Footer
            pdf.setFontSize(8);
            pdf.setTextColor(100, 100, 100);
            pdf.text('Thank you for your business!', 20, 280);
            pdf.text(`Generated by Kings Mart Professional v2.1 on ${new Date().toLocaleString()}`, 20, 290);
            
            pdf.save(`${invoice.id}.pdf`);
        }

        // Enhanced Utility Functions
        function showModal(title, message, confirmClass = 'btn-primary', onConfirm = null) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            const confirmBtn = document.getElementById('modalConfirmBtn');
            confirmBtn.className = `btn hover-glow ${confirmClass}`;
            
            appState.currentModal = onConfirm;
            document.getElementById('modalOverlay').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('show');
            appState.currentModal = null;
        }

        function confirmModal() {
            if (appState.currentModal) {
                appState.currentModal();
            }
            closeModal();
        }

        function showToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const icons = {
                success: '<i class="fas fa-check-circle"></i>',
                error: '<i class="fas fa-exclamation-circle"></i>',
                warning: '<i class="fas fa-exclamation-triangle"></i>',
                info: '<i class="fas fa-info-circle"></i>'
            };
            
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="color: var(--${type}); font-size: 1.25rem;">${icons[type]}</div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="removeToast(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                removeToast(toast);
            }, duration);
        }

        function removeToast(toastElement) {
            if (typeof toastElement === 'object' && toastElement.parentElement) {
                toastElement.classList.remove('show');
                setTimeout(() => {
                    if (toastElement.parentElement) {
                        toastElement.parentElement.removeChild(toastElement);
                    }
                }, 300);
            }
        }

        function shakeElement(element) {
            element.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
                element.style.animation = '';
            }, 500);
        }
            
        // Enhanced Settings Functions
        function updateSettingsStats() {
            const stats = {
                statsProducts: appState.stock.length,
                statsInvoices: appState.invoices.length,
                statsRevenue: appState.settings.currency + appState.invoices.reduce((sum, inv) => sum + inv.total, 0).toLocaleString(),
                statsCustomersSettings: appState.customers.length
            };
            
            Object.entries(stats).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        function saveSettings() {
            appState.settings.businessName = document.getElementById('settingsBusinessName').value;
            appState.settings.businessAddress = document.getElementById('settingsBusinessAddress').value;
            appState.settings.businessPhone = document.getElementById('settingsBusinessPhone').value;
            appState.settings.businessEmail = document.getElementById('settingsBusinessEmail').value;
            appState.settings.lowStockThreshold = parseInt(document.getElementById('settingsLowStockThreshold').value);
            appState.settings.taxRate = parseFloat(document.getElementById('settingsTaxRate').value);
            appState.settings.currency = document.getElementById('settingsCurrency').value;
            appState.settings.autoSave = document.getElementById('settingsAutoSave').checked;
            
            saveAppState();
            showToast(' Settings saved successfully!', 'success');
        }

        function exportAllData() {
            const data = {
                stock: appState.stock,
                cart: appState.cart,
                invoices: appState.invoices,
                customers: appState.customers,
                complaints: appState.complaints,
                orders: appState.orders,
                settings: appState.settings,
                exportDate: new Date().toISOString(),
                version: '2.1'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kingsmart-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast(' Data exported successfully!', 'success');
        }

        function resetAllData() {
            showModal(
                ' Reset System',
                'This will permanently delete all data including products, customers, invoices, and settings. Are you sure?',
                'btn-danger',
                () => {
                    localStorage.clear();
                    location.reload();
                }
            );
        }

        // Enhanced Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(event) {
                if (event.altKey) {
                    switch(event.key) {
                        case '1':
                            event.preventDefault();
                            showPage('dashboard');
                            break;
                        case '2':
                            event.preventDefault();
                            showPage('stock');
                            break;
                        case '3':
                            event.preventDefault();
                            showPage('cart');
                            break;
                        case '4':
                            event.preventDefault();
                            showPage('invoice');
                            break;
                        case '9':
                            event.preventDefault();
                            showPage('customers');
                            break;
                        case 's':
                            event.preventDefault();
                            if (appState.currentPage === 'settings') {
                                saveSettings();
                            } else {
                                saveAppState();
                                showToast(' Data saved!', 'success');
                            }
                            break;
                        case 'e':
                            event.preventDefault();
                            exportAllData();
                            break;
                    }
                }
                
                if (event.key === 'Escape') {
                    closeModal();
                    document.getElementById('productSuggestions').classList.add('hidden');
                }
            });
        }

        // Enhanced Theme Toggle
        function toggleTheme() {
            appState.theme = appState.theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', appState.theme);
            localStorage.setItem('theme', appState.theme);
            updateThemeIcon();
            showToast(` Switched to ${appState.theme} theme`, 'info');
        }

        function updateThemeIcon() {
            const themeIcon = document.getElementById('themeIcon');
            themeIcon.className = appState.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }

        // Enhanced Sidebar Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggleIcon');
            
            sidebar.classList.toggle('collapsed');
            appState.sidebarCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', appState.sidebarCollapsed);
            
            toggleIcon.style.transform = appState.sidebarCollapsed ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Enhanced User Functions
        function toggleUserMenu() {
            const dropdown = document.querySelector('.dropdown');
            dropdown.classList.toggle('show');
        }

  
        // Enhanced Data Management
        function saveAppState() {
            try {
                localStorage.setItem('stock', JSON.stringify(appState.stock));
                localStorage.setItem('cart', JSON.stringify(appState.cart));
                localStorage.setItem('invoices', JSON.stringify(appState.invoices));
                localStorage.setItem('customers', JSON.stringify(appState.customers));
                localStorage.setItem('complaints', JSON.stringify(appState.complaints));
                localStorage.setItem('orders', JSON.stringify(appState.orders));
                localStorage.setItem('settings', JSON.stringify(appState.settings));
                localStorage.setItem('analytics', JSON.stringify(appState.analytics));
            } catch (error) {
                showToast(' Error saving data', 'error');
            }
        }
function exportTableToCSV(tableId, filename = 'export.csv') {
    const table = document.getElementById(tableId);
    if (!table) return;
    let csv = [];
    let rows = table.querySelectorAll('tr');
    for (let row of rows) {
        let cols = row.querySelectorAll('th,td');
        let rowData = [];
        for (let cell of cols) {
            let data = (cell.innerText || '').replace(/"/g, '""');
            rowData.push('"' + data + '"');
        }
        csv.push(rowData.join(','));
    }
    let csvContent = csv.join('\n');
    let blob = new Blob([csvContent], { type: 'text/csv' });
    let url = URL.createObjectURL(blob);
    let a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

        // Auto-save functionality
        setInterval(() => {
            if (appState.settings.autoSave && appState.user) {
                saveAppState();
            }
        }, 30000);

        // Enhanced Form Validation
        function showFieldError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(fieldId + '-error');
            
            field.style.borderColor = 'var(--error)';
            field.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
            
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
            }
            
            shakeElement(field);
            field.focus();
        }

        function clearFormErrors() {
            document.querySelectorAll('.form-error').forEach(error => {
                error.classList.add('hidden');
            });
            
            document.querySelectorAll('.form-control').forEach(field => {
                field.style.borderColor = '';
                field.style.boxShadow = '';
            });
        }

        // Enhanced Low Stock Management
        function checkLowStock() {
            const lowStockItems = appState.stock.filter(p => p.quantity < appState.settings.lowStockThreshold);
            const alert = document.getElementById('lowStockAlert');
            
            if (lowStockItems.length > 0 && appState.currentPage === 'stock') {
                alert.classList.remove('hidden');
            } else {
                alert.classList.add('hidden');
            }
        }

        function showLowStockItems() {
            const lowStockItems = appState.stock.filter(p => p.quantity < appState.settings.lowStockThreshold);
            const message = lowStockItems.map(item => 
                ` ${item.name}: ${item.quantity} units remaining`
            ).join('\n');
            
            showModal(
                ' Low Stock Items',
                `The following items need restocking:\n\n${message}`,
                'btn-warning'
            );
        }

        // Click outside to close dropdowns
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            }
            
            if (!event.target.closest('.search-input')) {
                document.getElementById('productSuggestions')?.classList.add('hidden');
            }
        });

        // Enhanced Animation Setup
        function setupAdvancedAnimations() {
            // Intersection Observer for scroll animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });

            // Observe all animatable elements
            document.querySelectorAll('.card, .stat-card, .quick-action').forEach(el => {
                observer.observe(el);
            });
        }

        // Performance optimization
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Optimize search function
        const optimizedSearch = debounce(searchProducts, 300);
function logout() {
    showModal(
        ' Logout Confirmation',
        'Are you sure you want to logout? Any unsaved changes will be preserved.',
        'btn-primary',
        () => {
            showToast(' Logging out... See you soon!', 'info');
            setTimeout(() => {
                appState.user = null;
                saveAppState();  // optional: save state if needed
                document.getElementById('dashboardPage').classList.add('hidden');
                document.getElementById('loginPage').classList.remove('hidden');
                document.getElementById('loginUsername').focus();
            }, 1500);
        }
    );
}

        // Final initialization
        console.log(' Kings Mart Professional v2.1 - Complete Customer Management System Ready!');
        console.log(' Features: Advanced Analytics, Customer CRM, Order Tracking, Complaint Management');
        console.log('  Keyboard Shortcuts: Alt+1-9 for navigation, Alt+S to save, Alt+E to export');
        console.log(' Built with love for modern businesses');
    </script>
</body>
</html>

